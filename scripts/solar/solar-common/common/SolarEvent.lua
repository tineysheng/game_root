local ____lualib = require("lualib_bundle")
local __TS__New = ____lualib.__TS__New
local __TS__Class = ____lualib.__TS__Class
local __TS__SourceMapTraceBack = ____lualib.__TS__SourceMapTraceBack
__TS__SourceMapTraceBack(debug.getinfo(1).short_src, {["7"] = 2,["8"] = 2,["9"] = 3,["10"] = 3,["11"] = 4,["12"] = 4,["13"] = 5,["14"] = 5,["15"] = 6,["16"] = 6,["17"] = 7,["18"] = 7,["19"] = 8,["20"] = 8,["21"] = 9,["22"] = 9,["23"] = 10,["24"] = 10,["25"] = 11,["26"] = 11,["27"] = 12,["28"] = 12,["29"] = 13,["30"] = 13,["31"] = 14,["32"] = 14,["33"] = 15,["34"] = 15,["35"] = 17,["36"] = 18,["37"] = 25,["38"] = 25,["39"] = 25,["41"] = 29,["42"] = 30,["45"] = 28,["46"] = 41,["47"] = 42,["48"] = 43,["49"] = 43,["50"] = 43,["51"] = 44,["52"] = 45,["53"] = 45,["54"] = 45,["56"] = 46,["57"] = 46,["58"] = 47,["59"] = 46,["62"] = 45,["63"] = 45,["64"] = 50,["65"] = 43,["66"] = 43,["67"] = 52,["68"] = 52,["69"] = 52,["70"] = 53,["71"] = 52,["72"] = 52,["73"] = 52,["74"] = 41,["75"] = 63,["76"] = 64,["77"] = 63,["78"] = 72,["79"] = 72,["80"] = 72,["82"] = 73,["83"] = 73,["84"] = 73,["85"] = 74,["86"] = 73,["87"] = 73,["88"] = 73,["89"] = 72,["90"] = 84,["91"] = 84,["92"] = 84,["94"] = 85,["95"] = 86,["96"] = 86,["97"] = 86,["98"] = 87,["99"] = 88,["101"] = 89,["102"] = 89,["103"] = 90,["104"] = 90,["105"] = 90,["106"] = 90,["107"] = 90,["108"] = 90,["109"] = 89,["112"] = 92,["113"] = 92,["114"] = 92,["116"] = 93,["117"] = 93,["118"] = 94,["119"] = 93,["122"] = 92,["123"] = 92,["124"] = 97,["125"] = 86,["126"] = 86,["127"] = 99,["128"] = 99,["129"] = 99,["130"] = 100,["131"] = 99,["132"] = 99,["133"] = 99,["134"] = 84,["135"] = 108,["136"] = 108,["137"] = 108,["139"] = 109,["140"] = 111,["141"] = 111,["142"] = 111,["143"] = 112,["144"] = 113,["145"] = 114,["146"] = 115,["147"] = 115,["148"] = 115,["150"] = 116,["151"] = 116,["152"] = 117,["153"] = 116,["156"] = 115,["157"] = 115,["158"] = 121,["159"] = 111,["160"] = 111,["161"] = 123,["162"] = 123,["163"] = 123,["164"] = 124,["167"] = 127,["168"] = 127,["169"] = 127,["170"] = 127,["171"] = 127,["172"] = 123,["173"] = 123,["174"] = 123,["175"] = 108,["176"] = 136,["177"] = 136,["178"] = 136,["180"] = 137,["181"] = 138,["182"] = 138,["183"] = 138,["184"] = 139,["185"] = 140,["186"] = 141,["187"] = 142,["188"] = 142,["189"] = 142,["191"] = 143,["192"] = 143,["193"] = 144,["194"] = 143,["197"] = 142,["198"] = 142,["199"] = 147,["200"] = 138,["201"] = 138,["202"] = 149,["203"] = 149,["204"] = 149,["205"] = 150,["208"] = 153,["209"] = 149,["210"] = 149,["211"] = 149,["212"] = 136,["213"] = 160,["214"] = 160,["215"] = 160,["217"] = 161,["218"] = 162,["219"] = 162,["220"] = 162,["221"] = 163,["222"] = 164,["223"] = 165,["224"] = 167,["225"] = 168,["226"] = 169,["227"] = 169,["228"] = 169,["230"] = 170,["231"] = 170,["232"] = 171,["233"] = 170,["236"] = 169,["237"] = 169,["238"] = 174,["239"] = 162,["240"] = 162,["241"] = 176,["242"] = 176,["243"] = 176,["244"] = 177,["245"] = 176,["246"] = 176,["247"] = 176,["248"] = 160,["249"] = 184,["250"] = 184,["251"] = 184,["253"] = 185,["254"] = 186,["255"] = 186,["256"] = 186,["257"] = 187,["258"] = 188,["259"] = 189,["260"] = 191,["261"] = 192,["262"] = 193,["263"] = 193,["264"] = 193,["266"] = 194,["267"] = 194,["268"] = 195,["269"] = 194,["272"] = 193,["273"] = 193,["274"] = 198,["275"] = 186,["276"] = 186,["277"] = 200,["278"] = 200,["279"] = 200,["280"] = 201,["281"] = 200,["282"] = 200,["283"] = 200,["284"] = 184,["285"] = 209,["286"] = 210,["287"] = 211,["288"] = 211,["289"] = 211,["290"] = 212,["291"] = 213,["292"] = 214,["293"] = 214,["294"] = 214,["295"] = 214,["296"] = 216,["297"] = 217,["298"] = 218,["299"] = 218,["300"] = 218,["302"] = 219,["303"] = 219,["304"] = 220,["305"] = 219,["308"] = 218,["309"] = 218,["310"] = 223,["311"] = 211,["312"] = 211,["313"] = 225,["314"] = 225,["315"] = 225,["316"] = 226,["317"] = 225,["318"] = 225,["319"] = 225,["320"] = 209,["321"] = 235,["322"] = 236,["323"] = 236,["324"] = 236,["325"] = 237,["326"] = 236,["327"] = 236,["328"] = 235,["329"] = 245,["330"] = 246,["331"] = 246,["332"] = 246,["333"] = 247,["334"] = 246,["335"] = 246,["336"] = 245,["337"] = 255,["338"] = 256,["339"] = 256,["340"] = 256,["341"] = 257,["342"] = 256,["343"] = 256,["344"] = 255,["345"] = 266,["346"] = 267,["347"] = 267,["348"] = 267,["349"] = 268,["350"] = 267,["351"] = 267,["352"] = 266,["353"] = 277,["354"] = 278,["355"] = 278,["356"] = 278,["357"] = 279,["358"] = 278,["359"] = 278,["360"] = 277,["361"] = 288,["362"] = 289,["363"] = 289,["364"] = 289,["365"] = 290,["366"] = 289,["367"] = 289,["368"] = 288,["369"] = 298,["370"] = 299,["371"] = 299,["372"] = 299,["373"] = 300,["374"] = 299,["375"] = 299,["376"] = 298,["377"] = 308,["378"] = 309,["379"] = 309,["380"] = 309,["381"] = 310,["382"] = 309,["383"] = 309,["384"] = 308,["385"] = 318,["386"] = 319,["387"] = 319,["388"] = 319,["389"] = 320,["390"] = 319,["391"] = 319,["392"] = 318,["393"] = 336,["394"] = 337,["395"] = 337,["396"] = 337,["397"] = 338,["398"] = 339,["399"] = 340,["400"] = 341,["401"] = 342,["404"] = 345,["405"] = 346,["407"] = 348,["408"] = 349,["409"] = 337,["410"] = 337,["411"] = 336,["412"] = 359,["413"] = 360,["414"] = 359,["415"] = 368,["416"] = 369,["417"] = 368,["418"] = 377,["419"] = 378,["420"] = 377,["421"] = 385,["422"] = 386,["423"] = 386,["424"] = 386,["425"] = 387,["426"] = 387,["427"] = 387,["428"] = 387,["429"] = 386,["430"] = 386,["431"] = 385,["432"] = 396,["433"] = 397,["434"] = 398,["435"] = 399,["436"] = 400,["437"] = 400,["438"] = 400,["439"] = 401,["440"] = 400,["441"] = 400,["442"] = 400,["443"] = 396,["444"] = 410,["445"] = 411,["446"] = 411,["447"] = 411,["448"] = 412,["449"] = 411,["450"] = 411,["451"] = 411,["452"] = 410,["453"] = 420,["454"] = 421,["455"] = 421,["456"] = 421,["457"] = 422,["458"] = 421,["459"] = 421,["460"] = 420,["461"] = 430,["462"] = 431,["463"] = 431,["464"] = 431,["465"] = 432,["466"] = 431,["467"] = 431,["468"] = 430,["469"] = 441,["470"] = 442,["471"] = 442,["472"] = 442,["473"] = 443,["474"] = 443,["475"] = 443,["476"] = 443,["477"] = 442,["478"] = 442,["479"] = 441,["480"] = 451,["481"] = 452,["482"] = 452,["483"] = 452,["484"] = 453,["485"] = 452,["486"] = 452,["487"] = 451,["488"] = 461,["489"] = 462,["490"] = 462,["491"] = 462,["492"] = 463,["493"] = 462,["494"] = 462,["495"] = 461,["496"] = 472,["497"] = 473,["498"] = 474,["499"] = 475,["501"] = 473,["502"] = 472,["503"] = 484,["504"] = 485,["505"] = 485,["506"] = 485,["507"] = 486,["508"] = 485,["509"] = 485,["510"] = 484,["511"] = 493,["512"] = 494,["513"] = 495,["514"] = 495,["515"] = 495,["516"] = 497,["517"] = 498,["519"] = 499,["520"] = 499,["521"] = 500,["522"] = 500,["523"] = 500,["524"] = 500,["525"] = 500,["526"] = 500,["527"] = 499,["530"] = 502,["531"] = 502,["532"] = 502,["534"] = 503,["535"] = 503,["536"] = 504,["537"] = 503,["540"] = 507,["541"] = 507,["542"] = 507,["543"] = 507,["544"] = 507,["545"] = 508,["547"] = 509,["548"] = 509,["549"] = 510,["550"] = 509,["554"] = 513,["555"] = 513,["556"] = 513,["557"] = 513,["558"] = 513,["559"] = 514,["561"] = 515,["562"] = 515,["563"] = 516,["564"] = 515,["568"] = 502,["569"] = 502,["570"] = 520,["571"] = 495,["572"] = 495,["573"] = 522,["574"] = 523,["576"] = 525,["577"] = 526,["579"] = 528,["580"] = 528,["581"] = 528,["582"] = 529,["583"] = 529,["584"] = 529,["585"] = 529,["586"] = 528,["587"] = 528,["588"] = 528,["589"] = 493,["590"] = 536,["591"] = 537,["592"] = 538,["593"] = 538,["594"] = 538,["595"] = 540,["596"] = 541,["598"] = 542,["599"] = 542,["600"] = 543,["601"] = 543,["602"] = 543,["603"] = 543,["604"] = 543,["605"] = 543,["606"] = 542,["609"] = 545,["610"] = 545,["611"] = 545,["613"] = 546,["614"] = 546,["615"] = 547,["616"] = 546,["619"] = 550,["620"] = 550,["621"] = 550,["622"] = 550,["623"] = 550,["624"] = 551,["626"] = 552,["627"] = 552,["628"] = 553,["629"] = 552,["633"] = 545,["634"] = 545,["635"] = 557,["636"] = 538,["637"] = 538,["638"] = 559,["639"] = 560,["641"] = 562,["642"] = 562,["643"] = 562,["644"] = 563,["645"] = 562,["646"] = 562,["647"] = 562,["648"] = 536,["649"] = 571,["650"] = 572,["651"] = 573,["652"] = 573,["653"] = 573,["654"] = 575,["655"] = 577,["656"] = 577,["657"] = 577,["658"] = 577,["659"] = 577,["660"] = 578,["661"] = 579,["663"] = 580,["664"] = 580,["665"] = 581,["666"] = 580,["669"] = 583,["671"] = 575,["672"] = 573,["673"] = 573,["674"] = 588,["675"] = 590,["676"] = 591,["677"] = 591,["678"] = 591,["679"] = 592,["680"] = 591,["681"] = 591,["682"] = 591,["683"] = 571,["684"] = 604,["685"] = 606,["686"] = 607,["687"] = 608,["688"] = 609,["689"] = 610,["690"] = 610,["691"] = 610,["693"] = 611,["694"] = 611,["695"] = 612,["696"] = 611,["699"] = 610,["700"] = 610,["701"] = 615,["702"] = 615,["703"] = 615,["704"] = 616,["705"] = 615,["706"] = 615,["707"] = 615,["708"] = 618,["709"] = 619,["710"] = 620,["711"] = 618,["712"] = 622,["713"] = 604,["714"] = 628,["715"] = 629,["716"] = 630,["717"] = 628,["718"] = 634,["719"] = 635,["720"] = 636,["721"] = 637,["722"] = 638,["724"] = 640,["725"] = 641,["727"] = 643,["729"] = 645,["730"] = 645,["731"] = 645,["732"] = 634,["733"] = 648,["734"] = 649,["735"] = 650,["736"] = 651,["737"] = 652,["739"] = 654,["740"] = 655,["742"] = 657,["744"] = 659,["745"] = 659,["746"] = 659,["747"] = 648,["748"] = 663,["749"] = 664,["750"] = 665,["751"] = 666,["752"] = 667,["754"] = 669,["755"] = 670,["757"] = 672,["759"] = 674,["760"] = 674,["761"] = 674,["762"] = 663,["763"] = 678,["764"] = 679,["765"] = 680,["766"] = 680,["767"] = 680,["768"] = 680,["769"] = 681,["770"] = 682,["772"] = 684,["773"] = 685,["775"] = 687,["777"] = 689,["778"] = 689,["779"] = 689,["780"] = 689,["781"] = 689,["782"] = 689,["783"] = 678,["784"] = 330});
local ____exports = {}
local ____mitt = require("solar.solar-common.lib.mitt")
local mitt = ____mitt.default
local ____Cache = require("solar.solar-common.tool.Cache")
local Cache = ____Cache.default
local ____TriggerUtil = require("solar.solar-common.util.system.TriggerUtil")
local TriggerUtil = ____TriggerUtil.default
local ____UnitSpellEvent = require("solar.solar-common.tool.event.UnitSpellEvent")
local UnitSpellEvent = ____UnitSpellEvent.default
local ____UnitDeathEvent = require("solar.solar-common.tool.event.UnitDeathEvent")
local UnitDeathEvent = ____UnitDeathEvent.default
local ____UnitAttackedEvent = require("solar.solar-common.tool.event.UnitAttackedEvent")
local UnitAttackedEvent = ____UnitAttackedEvent.default
local ____UnitDamagedEvent = require("solar.solar-common.tool.event.UnitDamagedEvent")
local UnitDamagedEvent = ____UnitDamagedEvent.default
local ____UnitEvent = require("solar.solar-common.tool.event.UnitEvent")
local UnitEvent = ____UnitEvent.default
local ____UnitItemEvent = require("solar.solar-common.tool.event.UnitItemEvent")
local UnitItemEvent = ____UnitItemEvent.default
local ____SingletonUtil = require("solar.solar-common.util.lang.SingletonUtil")
local SingletonUtil = ____SingletonUtil.default
local ____SolarTrigger = require("solar.solar-common.common.SolarTrigger")
local SolarTrigger = ____SolarTrigger.default
local ____DataBase = require("solar.solar-common.common.DataBase")
local DataBase = ____DataBase.default
local ____PlayerEvent = require("solar.solar-common.tool.event.PlayerEvent")
local PlayerEvent = ____PlayerEvent.default
local ____UIFrameEvent = require("solar.solar-common.tool.event.UIFrameEvent")
local UIFrameEvent = ____UIFrameEvent.default
local emitter = mitt()
local cache = __TS__New(Cache)
____exports.default = __TS__Class()
local SolarEvent = ____exports.default
SolarEvent.name = "SolarEvent"
function SolarEvent.prototype.____constructor(self)
    if SingletonUtil:notFirstTime(____exports.default) then
        print("不能重复new SolarEvent() 请直接使用全局变量se进行访问")
        return
    end
end
function SolarEvent.prototype.on(self, ____type, handler)
    local key = "on:" .. tostring(____type)
    local solarTriggerSet = cache:get(
        key,
        function()
            local stSet = {}
            emitter:on(
                ____type,
                function(data)
                    do
                        local i = #stSet - 1
                        while i >= 0 do
                            stSet[i + 1]:exec(data)
                            i = i - 1
                        end
                    end
                end
            )
            return stSet
        end
    )
    return __TS__New(
        SolarTrigger,
        function(____self, data)
            handler(data, ____self)
        end,
        solarTriggerSet
    )
end
function SolarEvent.prototype.emit(self, ____type, data)
    emitter:emit(____type, data)
end
function SolarEvent.prototype.playerChat(self, chatMessageToDetect, callback, exactMatchOnly)
    if exactMatchOnly == nil then
        exactMatchOnly = true
    end
    return self:onPlayerChat(
        chatMessageToDetect,
        function(e, s)
            callback(e.triggerPlayer, e.eventPlayerChatString)
        end,
        exactMatchOnly
    )
end
function SolarEvent.prototype.onPlayerChat(self, chatMessageToDetect, callback, exactMatchOnly)
    if exactMatchOnly == nil then
        exactMatchOnly = true
    end
    local key = (("onPlayerChat:" .. chatMessageToDetect) .. ":") .. tostring(exactMatchOnly)
    local solarTriggerSet = cache:get(
        key,
        function()
            local stSet = {}
            local trigger = CreateTrigger()
            do
                local i = 0
                while i < bj_MAX_PLAYER_SLOTS do
                    TriggerRegisterPlayerChatEvent(
                        trigger,
                        Player(i),
                        chatMessageToDetect,
                        exactMatchOnly
                    )
                    i = i + 1
                end
            end
            TriggerAddAction(
                trigger,
                function()
                    do
                        local i = #stSet - 1
                        while i >= 0 do
                            stSet[i + 1]:exec()
                            i = i - 1
                        end
                    end
                end
            )
            return stSet
        end
    )
    return __TS__New(
        SolarTrigger,
        function(solarTrigger)
            callback(PlayerEvent.instance, solarTrigger)
        end,
        solarTriggerSet
    )
end
function SolarEvent.prototype.unitDamaged(self, callback, onlyHasDamageSource)
    if onlyHasDamageSource == nil then
        onlyHasDamageSource = true
    end
    local key = "unitDamaged"
    local solarTriggerSet = cache:get(
        key,
        function()
            local stSet = {}
            local trigger = CreateTrigger()
            TriggerUtil.SystemAnyUnitDamagedRegistTrigger(trigger)
            TriggerAddAction(
                trigger,
                function()
                    do
                        local i = #stSet - 1
                        while i >= 0 do
                            stSet[i + 1]:exec()
                            i = i - 1
                        end
                    end
                end
            )
            return stSet
        end
    )
    return __TS__New(
        SolarTrigger,
        function()
            if onlyHasDamageSource and not IsHandle(GetEventDamageSource()) then
                return
            end
            callback(
                GetTriggerUnit(),
                GetEventDamageSource(),
                GetEventDamage()
            )
        end,
        solarTriggerSet
    )
end
function SolarEvent.prototype.onUnitDamaged(self, callback, onlyHasDamageSource)
    if onlyHasDamageSource == nil then
        onlyHasDamageSource = true
    end
    local key = "onUnitDamaged"
    local solarTriggerSet = cache:get(
        key,
        function()
            local stSet = {}
            local trigger = CreateTrigger()
            TriggerUtil.SystemAnyUnitDamagedRegistTrigger(trigger)
            TriggerAddAction(
                trigger,
                function()
                    do
                        local i = #stSet - 1
                        while i >= 0 do
                            stSet[i + 1]:exec()
                            i = i - 1
                        end
                    end
                end
            )
            return stSet
        end
    )
    return __TS__New(
        SolarTrigger,
        function(solarTrigger)
            if onlyHasDamageSource and not IsHandle(GetEventDamageSource()) then
                return
            end
            callback(UnitDamagedEvent.instance, solarTrigger)
        end,
        solarTriggerSet
    )
end
function SolarEvent.prototype.onLeaveRect(self, whichRect, callback)
    if whichRect == nil then
        whichRect = bj_mapInitialPlayableArea
    end
    local key = "onLeaveRect:" .. tostring(GetHandleId(whichRect))
    local solarTriggerSet = cache:get(
        key,
        function()
            local stSet = {}
            local rectRegion = CreateRegion()
            RegionAddRect(rectRegion, whichRect)
            local trigger = CreateTrigger()
            TriggerRegisterLeaveRegion(trigger, rectRegion, nil)
            TriggerAddAction(
                trigger,
                function()
                    do
                        local i = #stSet - 1
                        while i >= 0 do
                            stSet[i + 1]:exec()
                            i = i - 1
                        end
                    end
                end
            )
            return stSet
        end
    )
    return __TS__New(
        SolarTrigger,
        function(solarTrigger)
            callback(UnitEvent.instance, solarTrigger)
        end,
        solarTriggerSet
    )
end
function SolarEvent.prototype.onEnterRect(self, whichRect, callback)
    if whichRect == nil then
        whichRect = bj_mapInitialPlayableArea
    end
    local key = "onEnterRect:" .. tostring(GetHandleId(whichRect))
    local solarTriggerSet = cache:get(
        key,
        function()
            local stSet = {}
            local rectRegion = CreateRegion()
            RegionAddRect(rectRegion, whichRect)
            local trigger = CreateTrigger()
            TriggerRegisterEnterRegion(trigger, rectRegion, nil)
            TriggerAddAction(
                trigger,
                function()
                    do
                        local i = #stSet - 1
                        while i >= 0 do
                            stSet[i + 1]:exec()
                            i = i - 1
                        end
                    end
                end
            )
            return stSet
        end
    )
    return __TS__New(
        SolarTrigger,
        function(solarTrigger)
            callback(UnitEvent.instance, solarTrigger)
        end,
        solarTriggerSet
    )
end
function SolarEvent.prototype.onUnitEnterMapRect(self, callback)
    local key = "onUnitEnterMapRect"
    local solarTriggerSet = cache:get(
        key,
        function()
            local stSet = {}
            local rectRegion = CreateRegion()
            RegionAddRect(
                rectRegion,
                GetPlayableMapRect()
            )
            local trigger = CreateTrigger()
            TriggerRegisterEnterRegion(trigger, rectRegion, nil)
            TriggerAddAction(
                trigger,
                function()
                    do
                        local i = #stSet - 1
                        while i >= 0 do
                            stSet[i + 1]:exec()
                            i = i - 1
                        end
                    end
                end
            )
            return stSet
        end
    )
    return __TS__New(
        SolarTrigger,
        function(solarTrigger)
            callback(UnitEvent.instance, solarTrigger)
        end,
        solarTriggerSet
    )
end
function SolarEvent.prototype.onUnitPawnItem(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_PAWN_ITEM,
        function(triggerUnit, solarTrigger)
            callback(UnitItemEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.onUnitSellItem(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_SELL_ITEM,
        function(triggerUnit, solarTrigger)
            callback(UnitItemEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.onUnitPickupItem(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_PICKUP_ITEM,
        function(triggerUnit, solarTrigger)
            callback(UnitItemEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.onUnitDropItem(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_DROP_ITEM,
        function(triggerUnit, solarTrigger)
            callback(UnitItemEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.onUnitUseItem(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_USE_ITEM,
        function(triggerUnit, solarTrigger)
            callback(UnitItemEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.onUnitConstructStart(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_CONSTRUCT_START,
        function(triggerUnit, solarTrigger)
            callback(UnitEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.onUnitConstructFinish(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_CONSTRUCT_FINISH,
        function(triggerUnit, solarTrigger)
            callback(UnitEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.onUnitUpgradeFinish(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_UPGRADE_FINISH,
        function(triggerUnit, solarTrigger)
            callback(UnitEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.onUnitSelected(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_SELECTED,
        function(triggerUnit, solarTrigger)
            callback(UnitEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.onUnitDoubleClickSelected(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_SELECTED,
        function(triggerUnit, solarTrigger)
            local tu = GetTriggerUnit()
            local playerId = GetPlayerId(GetOwningPlayer(tu))
            local lastSelectInfo = ____exports.default._sl_last_select_info[playerId]
            if lastSelectInfo == nil then
                ____exports.default._sl_last_select_info[playerId] = {unit = tu, time = _g_time}
                return
            end
            if lastSelectInfo.unit == tu and _g_time - lastSelectInfo.time < 1000 then
                callback(UnitEvent.instance, solarTrigger)
            end
            lastSelectInfo.unit = tu
            lastSelectInfo.time = _g_time
        end
    )
end
function SolarEvent.prototype.onUnitSpellChannel(self, callback, abilityId)
    return self:anyUnitSpellEvent(EVENT_PLAYER_UNIT_SPELL_CHANNEL, callback, abilityId)
end
function SolarEvent.prototype.onUnitSpellCast(self, callback, abilityId)
    return self:anyUnitSpellEvent(EVENT_PLAYER_UNIT_SPELL_CAST, callback, abilityId)
end
function SolarEvent.prototype.onUnitSpellEffect(self, callback, abilityId)
    return self:anyUnitSpellEvent(EVENT_PLAYER_UNIT_SPELL_EFFECT, callback, abilityId)
end
function SolarEvent.prototype.unitDeath(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_DEATH,
        function(triggerUnit)
            callback(
                triggerUnit,
                GetKillingUnit()
            )
        end
    )
end
function SolarEvent.prototype.onUnitTypeDeath(self, callback, unitTypeIdStr)
    self:anyUnitEvent(EVENT_PLAYER_UNIT_DEATH, nil)
    local key = "anyUnitEvent:" .. tostring(GetHandleId(EVENT_PLAYER_UNIT_DEATH))
    local solarTriggerSet = ____exports.default:getUnitTypeDataEventHandler(unitTypeIdStr, key, true)
    return __TS__New(
        SolarTrigger,
        function(solarTrigger)
            callback(UnitDeathEvent.instance, solarTrigger)
        end,
        solarTriggerSet
    )
end
function SolarEvent.prototype.onUnitDeath(self, callback, unit)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_DEATH,
        function(t, solarTrigger)
            callback(UnitDeathEvent.instance, solarTrigger)
        end,
        unit
    )
end
function SolarEvent.prototype.onUnitResearchStart(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_RESEARCH_START,
        function(triggerUnit, solarTrigger)
            callback(UnitEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.onUnitResearchFinish(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_RESEARCH_FINISH,
        function(triggerUnit, solarTrigger)
            callback(UnitEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.unitAttacked(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_ATTACKED,
        function(triggerUnit)
            callback(
                triggerUnit,
                GetAttacker()
            )
        end
    )
end
function SolarEvent.prototype.onUnitAttacked(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_ATTACKED,
        function(triggerUnit, solarTrigger)
            callback(UnitAttackedEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.onUnitSellUnit(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_UNIT_SELL,
        function(triggerUnit, solarTrigger)
            callback(UnitEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.onUnitAttackedDamage(self, callback)
    return self:onUnitDamaged(function(e, solarTrigger)
        if 0 ~= EXGetEventDamageData(EVENT_DAMAGE_DATA_IS_ATTACK) then
            callback(e, solarTrigger)
        end
    end)
end
function SolarEvent.prototype.onHeroLevelUp(self, callback)
    return self:anyUnitEvent(
        EVENT_PLAYER_HERO_LEVEL,
        function(triggerUnit, solarTrigger)
            callback(UnitEvent.instance, solarTrigger)
        end
    )
end
function SolarEvent.prototype.anyUnitEvent(self, whichPlayerUnitEvent, callback, unit)
    local key = "anyUnitEvent:" .. tostring(GetHandleId(whichPlayerUnitEvent))
    local solarTriggerSet = cache:get(
        key,
        function()
            local stSet = {}
            local trigger = CreateTrigger()
            do
                local i = 0
                while i < bj_MAX_PLAYER_SLOTS do
                    TriggerRegisterPlayerUnitEvent(
                        trigger,
                        Player(i),
                        whichPlayerUnitEvent,
                        nil
                    )
                    i = i + 1
                end
            end
            TriggerAddAction(
                trigger,
                function()
                    do
                        local i = #stSet - 1
                        while i >= 0 do
                            stSet[i + 1]:exec()
                            i = i - 1
                        end
                    end
                    local dataEventHandler = ____exports.default:getUnitDataEventHandler(
                        GetTriggerUnit(),
                        key,
                        false
                    )
                    if dataEventHandler then
                        do
                            local i = #dataEventHandler - 1
                            while i >= 0 do
                                dataEventHandler[i + 1]:exec()
                                i = i - 1
                            end
                        end
                    end
                    dataEventHandler = ____exports.default:getUnitTypeDataEventHandler(
                        id2string(GetUnitTypeId(GetTriggerUnit())),
                        key,
                        false
                    )
                    if dataEventHandler then
                        do
                            local i = #dataEventHandler - 1
                            while i >= 0 do
                                dataEventHandler[i + 1]:exec()
                                i = i - 1
                            end
                        end
                    end
                end
            )
            return stSet
        end
    )
    if callback == nil then
        return nil
    end
    if IsHandle(unit) then
        solarTriggerSet = ____exports.default:getUnitDataEventHandler(unit, key, true)
    end
    return __TS__New(
        SolarTrigger,
        function(solarTrigger)
            callback(
                GetTriggerUnit(),
                solarTrigger
            )
        end,
        solarTriggerSet
    )
end
function SolarEvent.prototype.anyUnitSpellEvent(self, whichPlayerUnitEvent, callback, spellAbilityId)
    local key = "anyUnitSpellEvent:" .. tostring(GetHandleId(whichPlayerUnitEvent))
    local solarTriggerSet = cache:get(
        key,
        function()
            local stSet = {}
            local trigger = CreateTrigger()
            do
                local i = 0
                while i < bj_MAX_PLAYER_SLOTS do
                    TriggerRegisterPlayerUnitEvent(
                        trigger,
                        Player(i),
                        whichPlayerUnitEvent,
                        nil
                    )
                    i = i + 1
                end
            end
            TriggerAddAction(
                trigger,
                function()
                    do
                        local i = #stSet - 1
                        while i >= 0 do
                            stSet[i + 1]:exec()
                            i = i - 1
                        end
                    end
                    local dataEventHandler = ____exports.default:getUnitSpellAbilityDataEventHandler(
                        id2string(GetSpellAbilityId()),
                        key,
                        false
                    )
                    if dataEventHandler then
                        do
                            local i = #dataEventHandler - 1
                            while i >= 0 do
                                dataEventHandler[i + 1]:exec()
                                i = i - 1
                            end
                        end
                    end
                end
            )
            return stSet
        end
    )
    if spellAbilityId then
        solarTriggerSet = ____exports.default:getUnitSpellAbilityDataEventHandler(spellAbilityId, key, true)
    end
    return __TS__New(
        SolarTrigger,
        function(solarTrigger)
            callback(UnitSpellEvent.instance, solarTrigger)
        end,
        solarTriggerSet
    )
end
function SolarEvent.prototype.onFrameEvent(self, frame, event, callback)
    local key = "onFrameEvent:" .. tostring(event)
    local funcHandle = cache:get(
        key,
        function()
            return function()
                local dataEventHandler = ____exports.default:getFrameDataEventHandler(
                    DzGetTriggerUIEventFrame(),
                    key,
                    false
                )
                if dataEventHandler then
                    isAsync = true
                    do
                        local i = #dataEventHandler - 1
                        while i >= 0 do
                            dataEventHandler[i + 1]:exec()
                            i = i - 1
                        end
                    end
                    isAsync = false
                end
            end
        end
    )
    DzFrameSetScriptByCode(frame, event, funcHandle, false)
    local solarTriggerSet = ____exports.default:getFrameDataEventHandler(frame, key, true)
    return __TS__New(
        SolarTrigger,
        function(solarTrigger)
            callback(UIFrameEvent.instance, solarTrigger)
        end,
        solarTriggerSet
    )
end
function SolarEvent.prototype.onUnitInRange(self, unit, range, callback)
    handle_ref(unit)
    local solarTriggerSet = {}
    local t = CreateTrigger()
    TriggerRegisterUnitInRange(t, unit, range, nil)
    TriggerAddAction(
        t,
        function()
            do
                local i = #solarTriggerSet - 1
                while i >= 0 do
                    solarTriggerSet[i + 1]:exec()
                    i = i - 1
                end
            end
        end
    )
    local solarTrigger = __TS__New(
        SolarTrigger,
        function(solarTrigger)
            callback(UnitSpellEvent.instance, solarTrigger)
        end,
        solarTriggerSet
    )
    solarTrigger.onDestroy = function(solarTrigger)
        TriggerClearActions(t)
        DestroyTrigger(t)
    end
    return solarTrigger
end
function SolarEvent.prototype.clear(self)
    cache:clear()
    emitter.all:clear()
end
function SolarEvent.getUnitDataEventHandler(self, unit, eventKey, createDefault)
    if createDefault then
        local unitSolarData = DataBase:getUnitSolarData(unit, createDefault)
        if unitSolarData._SL_solarEventHandler == nil then
            unitSolarData._SL_solarEventHandler = {}
        end
        if unitSolarData._SL_solarEventHandler[eventKey] == nil then
            unitSolarData._SL_solarEventHandler[eventKey] = {}
        end
        return unitSolarData._SL_solarEventHandler[eventKey]
    end
    local ____opt_2 = DataBase:getUnitSolarData(unit, createDefault)
    local ____opt_0 = ____opt_2 and ____opt_2._SL_solarEventHandler
    return ____opt_0 and ____opt_0[eventKey]
end
function SolarEvent.getUnitTypeDataEventHandler(self, unitType, eventKey, createDefault)
    if createDefault then
        local unitSolarData = DataBase:getUnitTypeSolarData(unitType, createDefault)
        if unitSolarData._SL_solarEventHandler == nil then
            unitSolarData._SL_solarEventHandler = {}
        end
        if unitSolarData._SL_solarEventHandler[eventKey] == nil then
            unitSolarData._SL_solarEventHandler[eventKey] = {}
        end
        return unitSolarData._SL_solarEventHandler[eventKey]
    end
    local ____opt_6 = DataBase:getUnitTypeSolarData(unitType, createDefault)
    local ____opt_4 = ____opt_6 and ____opt_6._SL_solarEventHandler
    return ____opt_4 and ____opt_4[eventKey]
end
function SolarEvent.getUnitSpellAbilityDataEventHandler(self, abilityIdStr, eventKey, createDefault)
    if createDefault then
        local unitSolarData = DataBase:getAbilityTypeSolarData(abilityIdStr, createDefault)
        if unitSolarData._SL_solarEventHandler == nil then
            unitSolarData._SL_solarEventHandler = {}
        end
        if unitSolarData._SL_solarEventHandler[eventKey] == nil then
            unitSolarData._SL_solarEventHandler[eventKey] = {}
        end
        return unitSolarData._SL_solarEventHandler[eventKey]
    end
    local ____opt_10 = DataBase:getAbilityTypeSolarData(abilityIdStr, createDefault)
    local ____opt_8 = ____opt_10 and ____opt_10._SL_solarEventHandler
    return ____opt_8 and ____opt_8[eventKey]
end
function SolarEvent.getFrameDataEventHandler(self, frame, eventKey, createDefault)
    if createDefault then
        local unitSolarData = DataBase:getDataByTypeId(
            "_SL_Frame_Event",
            tostring(frame)
        )
        if unitSolarData._SL_solarEventHandler == nil then
            unitSolarData._SL_solarEventHandler = {}
        end
        if unitSolarData._SL_solarEventHandler[eventKey] == nil then
            unitSolarData._SL_solarEventHandler[eventKey] = {}
        end
        return unitSolarData._SL_solarEventHandler[eventKey]
    end
    local ____opt_14 = DataBase:getDataByTypeId(
        "_SL_Frame_Event",
        tostring(frame)
    )
    local ____opt_12 = ____opt_14 and ____opt_14._SL_solarEventHandler
    return ____opt_12 and ____opt_12[eventKey]
end
SolarEvent._sl_last_select_info = {}
return ____exports
