local ____lualib = require("lualib_bundle")
local __TS__Class = ____lualib.__TS__Class
local __TS__SourceMapTraceBack = ____lualib.__TS__SourceMapTraceBack
__TS__SourceMapTraceBack(debug.getinfo(1).short_src, {["6"] = 1,["7"] = 1,["8"] = 2,["9"] = 2,["10"] = 3,["11"] = 3,["12"] = 8,["13"] = 8,["14"] = 8,["16"] = 8,["17"] = 15,["18"] = 16,["19"] = 15,["20"] = 24,["21"] = 25,["22"] = 24,["23"] = 33,["24"] = 34,["25"] = 33,["26"] = 41,["27"] = 42,["28"] = 43,["29"] = 41,["30"] = 50,["31"] = 51,["32"] = 50,["33"] = 58,["34"] = 59,["35"] = 58,["36"] = 67,["37"] = 68,["38"] = 67,["39"] = 76,["40"] = 77,["41"] = 76,["42"] = 86,["43"] = 87,["44"] = 87,["45"] = 87,["46"] = 87,["47"] = 87,["48"] = 86,["49"] = 94,["50"] = 95,["51"] = 94,["52"] = 103,["53"] = 104,["54"] = 103,["55"] = 112,["56"] = 113,["57"] = 112,["58"] = 120,["59"] = 121,["60"] = 122,["61"] = 120,["62"] = 129,["63"] = 130,["64"] = 129,["65"] = 138,["66"] = 139,["67"] = 138,["68"] = 147,["69"] = 148,["70"] = 147,["71"] = 157,["72"] = 158,["73"] = 158,["74"] = 158,["75"] = 158,["76"] = 158,["77"] = 157,["78"] = 164,["79"] = 165,["80"] = 164,["81"] = 171,["82"] = 172,["83"] = 171,["84"] = 178,["85"] = 179,["86"] = 180,["87"] = 178,["88"] = 188,["89"] = 189,["90"] = 190,["91"] = 191,["92"] = 188,["93"] = 197,["94"] = 198,["95"] = 197,["96"] = 206,["97"] = 207,["98"] = 206,["99"] = 215,["100"] = 216,["101"] = 215,["102"] = 222,["103"] = 223,["104"] = 222,["105"] = 231,["106"] = 232,["107"] = 233,["109"] = 235,["110"] = 231,["111"] = 241,["112"] = 242,["113"] = 243,["114"] = 244,["116"] = 246,["117"] = 241,["118"] = 253,["119"] = 254,["120"] = 253,["121"] = 262,["122"] = 263,["123"] = 262,["124"] = 271,["125"] = 272,["126"] = 271,["127"] = 278,["128"] = 279,["129"] = 278,["130"] = 287,["131"] = 288,["132"] = 289,["133"] = 287,["134"] = 297,["135"] = 298,["136"] = 299,["137"] = 300,["138"] = 297,["139"] = 309,["140"] = 310,["141"] = 311,["142"] = 312,["143"] = 309,["144"] = 318,["145"] = 319,["146"] = 318,["147"] = 328,["148"] = 329,["149"] = 328,["150"] = 338,["151"] = 339,["152"] = 340,["153"] = 341,["154"] = 338,["155"] = 349,["156"] = 350,["157"] = 351,["158"] = 352,["161"] = 355,["162"] = 356,["163"] = 357,["164"] = 358,["165"] = 359,["166"] = 360,["167"] = 361,["168"] = 362,["169"] = 363,["170"] = 364,["171"] = 365,["172"] = 366,["173"] = 367,["174"] = 368,["175"] = 369,["176"] = 370,["178"] = 349,["179"] = 379,["180"] = 380,["181"] = 379,["182"] = 389,["183"] = 390,["184"] = 390,["185"] = 390,["186"] = 390,["187"] = 390,["188"] = 389,["189"] = 398,["190"] = 399,["191"] = 398,["192"] = 408,["193"] = 409,["194"] = 409,["195"] = 409,["196"] = 409,["197"] = 409,["198"] = 408,["199"] = 415,["200"] = 416,["201"] = 417,["203"] = 419,["204"] = 415,["205"] = 425,["206"] = 427,["207"] = 425,["208"] = 434,["209"] = 435,["210"] = 436,["212"] = 439,["213"] = 440,["214"] = 440,["215"] = 440,["216"] = 441,["217"] = 440,["218"] = 440,["219"] = 434,["220"] = 452,["221"] = 452,["222"] = 452,["224"] = 453,["225"] = 452,["226"] = 459,["227"] = 460,["228"] = 459,["229"] = 466,["230"] = 467,["231"] = 466,["232"] = 473,["233"] = 474,["234"] = 473,["235"] = 480,["236"] = 481,["237"] = 480,["238"] = 487,["239"] = 487,["240"] = 487,["242"] = 488,["243"] = 489,["244"] = 490,["245"] = 490,["246"] = 490,["247"] = 491,["248"] = 492,["249"] = 490,["250"] = 490,["251"] = 487,["252"] = 500,["253"] = 501,["254"] = 501,["255"] = 501,["256"] = 501,["257"] = 502,["258"] = 502,["259"] = 502,["260"] = 502,["261"] = 500,["262"] = 509,["263"] = 510,["264"] = 511,["266"] = 514,["267"] = 515,["269"] = 517,["270"] = 519,["271"] = 520,["272"] = 521,["274"] = 523,["275"] = 524,["277"] = 526,["278"] = 527,["280"] = 530,["281"] = 531,["283"] = 533,["284"] = 534,["286"] = 536,["287"] = 537,["289"] = 539,["290"] = 540,["292"] = 542,["293"] = 543,["295"] = 545,["296"] = 546,["298"] = 548,["299"] = 549,["301"] = 551,["302"] = 552,["304"] = 554,["305"] = 555,["308"] = 560,["309"] = 561,["310"] = 562,["312"] = 564,["313"] = 565,["315"] = 567,["316"] = 568,["318"] = 571,["319"] = 572,["321"] = 574,["322"] = 575,["324"] = 577,["325"] = 578,["327"] = 580,["328"] = 581,["330"] = 583,["331"] = 584,["333"] = 586,["334"] = 587,["336"] = 589,["337"] = 590,["339"] = 592,["340"] = 593,["342"] = 595,["343"] = 596,["346"] = 601,["347"] = 602,["348"] = 603,["349"] = 604,["351"] = 606,["352"] = 607,["354"] = 609,["355"] = 610,["357"] = 612,["358"] = 613,["359"] = 613,["362"] = 617,["363"] = 618,["365"] = 621,["366"] = 509});
local ____exports = {}
local ____BaseUtil = require("solar.solar-common.util.BaseUtil")
local BaseUtil = ____BaseUtil.default
local ____DataBase = require("solar.solar-common.common.DataBase")
local DataBase = ____DataBase.default
local ____MoveType = require("solar.solar-common.constant.MoveType")
local MoveType = ____MoveType.default
____exports.default = __TS__Class()
local UnitStateUtil = ____exports.default
UnitStateUtil.name = "UnitStateUtil"
function UnitStateUtil.prototype.____constructor(self)
end
function UnitStateUtil.getMaxLife(self, unitHandle)
    return GetUnitState(unitHandle, UNIT_STATE_MAX_LIFE)
end
function UnitStateUtil.setMaxLife(self, unitHandle, newVal)
    SetUnitState(unitHandle, UNIT_STATE_MAX_LIFE, newVal)
end
function UnitStateUtil.addMaxLife(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_MAX_LIFE, addVal)
end
function UnitStateUtil.addMaxLifeAndLife(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_MAX_LIFE, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_LIFE, addVal)
end
function UnitStateUtil.isAlive(self, unitHandle)
    return UnitAlive(unitHandle)
end
function UnitStateUtil.getLife(self, unitHandle)
    return GetUnitState(unitHandle, UNIT_STATE_LIFE)
end
function UnitStateUtil.setLife(self, unitHandle, newVal)
    SetUnitState(unitHandle, UNIT_STATE_LIFE, newVal)
end
function UnitStateUtil.addLife(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_LIFE, addVal)
end
function UnitStateUtil.addUnitLifeByMaxLifeP(self, unitHandle, proportion)
    ____exports.default:addUnitState(
        unitHandle,
        UNIT_STATE_LIFE,
        GetUnitState(unitHandle, UNIT_STATE_MAX_LIFE) * proportion
    )
end
function UnitStateUtil.getMaxMana(self, unitHandle)
    return GetUnitState(unitHandle, UNIT_STATE_MAX_MANA)
end
function UnitStateUtil.setMaxMana(self, unitHandle, newVal)
    SetUnitState(unitHandle, UNIT_STATE_MAX_MANA, newVal)
end
function UnitStateUtil.addMaxMana(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_MAX_MANA, addVal)
end
function UnitStateUtil.addMaxManaAndMana(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_MAX_MANA, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_MANA, addVal)
end
function UnitStateUtil.getMana(self, unitHandle)
    return GetUnitState(unitHandle, UNIT_STATE_MANA)
end
function UnitStateUtil.setMana(self, unitHandle, newVal)
    SetUnitState(unitHandle, UNIT_STATE_MANA, newVal)
end
function UnitStateUtil.addMana(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UNIT_STATE_MANA, addVal)
end
function UnitStateUtil.addUnitManaByMaxManaP(self, unitHandle, proportion)
    ____exports.default:addUnitState(
        unitHandle,
        UNIT_STATE_MANA,
        GetUnitState(unitHandle, UNIT_STATE_MAX_MANA) * proportion
    )
end
function UnitStateUtil.getDamageMax(self, unitHandle)
    return GetUnitState(unitHandle, UnitStateDamageMax)
end
function UnitStateUtil.getDamageBase(self, unitHandle)
    return GetUnitState(unitHandle, UnitStateDamageBase)
end
function UnitStateUtil.setDamageBase(self, unitHandle, newVal)
    newVal = math.min(newVal, 2100000000)
    SetUnitState(unitHandle, UnitStateDamageBase, newVal)
end
function UnitStateUtil.addDamageBase(self, unitHandle, addVal)
    local newVal = GetUnitState(unitHandle, UnitStateDamageBase) + addVal
    newVal = math.min(newVal, 2100000000)
    SetUnitState(unitHandle, UnitStateDamageBase, newVal)
end
function UnitStateUtil.getDamageRange(self, unitHandle)
    return GetUnitState(unitHandle, UnitStateDamageRange)
end
function UnitStateUtil.setDamageRange(self, unitHandle, newVal)
    SetUnitState(unitHandle, UnitStateDamageRange, newVal)
end
function UnitStateUtil.addDamageRange(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UnitStateDamageRange, addVal)
end
function UnitStateUtil.getDamageCool(self, unitHandle)
    return GetUnitState(unitHandle, UnitStateDamageCool)
end
function UnitStateUtil.setDamageCool(self, unitHandle, newVal)
    if newVal < 0.001 then
        newVal = 0.001
    end
    SetUnitState(unitHandle, UnitStateDamageCool, newVal)
end
function UnitStateUtil.addDamageCool(self, unitHandle, addVal)
    local newVal = GetUnitState(unitHandle, UnitStateDamageCool) + addVal
    if newVal < 0.001 then
        newVal = 0.001
    end
    SetUnitState(unitHandle, UnitStateDamageCool, newVal)
end
function UnitStateUtil.getAttackSpeed(self, unitHandle)
    return GetUnitState(unitHandle, UnitStateAttackSpeed)
end
function UnitStateUtil.setAttackSpeed(self, unitHandle, newVal)
    SetUnitState(unitHandle, UnitStateAttackSpeed, newVal)
end
function UnitStateUtil.addAttackSpeed(self, unitHandle, addVal)
    ____exports.default:addUnitState(unitHandle, UnitStateAttackSpeed, addVal)
end
function UnitStateUtil.getArmor(self, unitHandle)
    return GetUnitState(unitHandle, UnitStateArmor)
end
function UnitStateUtil.setArmor(self, unitHandle, newVal)
    newVal = math.min(newVal, 2100000000)
    SetUnitState(unitHandle, UnitStateArmor, newVal)
end
function UnitStateUtil.addArmor(self, unitHandle, addVal)
    local newVal = GetUnitState(unitHandle, UnitStateArmor) + addVal
    newVal = math.min(newVal, 2100000000)
    SetUnitState(unitHandle, UnitStateArmor, newVal)
end
function UnitStateUtil.addUnitState(self, unitHandle, whichUnitState, addVal)
    local newVal = GetUnitState(unitHandle, whichUnitState) + addVal
    SetUnitState(unitHandle, whichUnitState, newVal)
    return newVal
end
function UnitStateUtil.getMoveSpeed(self, unitHandle)
    return GetUnitMoveSpeed(unitHandle)
end
function UnitStateUtil.setMoveSpeed(self, unitHandle, newSpeed)
    SetUnitMoveSpeed(unitHandle, newSpeed)
end
function UnitStateUtil.addMoveSpeed(self, unitHandle, addSpeed)
    local newVal = GetUnitMoveSpeed(unitHandle) + addSpeed
    SetUnitMoveSpeed(unitHandle, newVal)
    return newVal
end
function UnitStateUtil.setMoveType(self, unitHandle, moveType)
    local moveTypeElement = MoveType[moveType]
    EXSetUnitMoveType(unitHandle, moveTypeElement)
    if SetUnitMoveType == nil then
        return
    end
    if moveTypeElement == 0 then
        SetUnitMoveType(unitHandle, "none")
    elseif moveTypeElement == 1 then
        SetUnitMoveType(unitHandle, "nomove")
    elseif moveTypeElement == 2 then
        SetUnitMoveType(unitHandle, "foot")
    elseif moveTypeElement == 4 then
        SetUnitMoveType(unitHandle, "fly")
    elseif moveTypeElement == 64 then
        SetUnitMoveType(unitHandle, "float")
    elseif moveTypeElement == 8 then
        SetUnitMoveType(unitHandle, "hover")
    elseif moveTypeElement == 128 then
        SetUnitMoveType(unitHandle, "amph")
    elseif moveTypeElement == 32 then
        SetUnitMoveType(unitHandle, "unbuild")
    end
end
function UnitStateUtil.getUnitLifeP(self, unitHandle)
    return GetUnitState(unitHandle, UNIT_STATE_LIFE) / GetUnitState(unitHandle, UNIT_STATE_MAX_LIFE)
end
function UnitStateUtil.setUnitLifeP(self, unitHandle, proportion)
    return SetUnitState(
        unitHandle,
        UNIT_STATE_LIFE,
        GetUnitState(unitHandle, UNIT_STATE_MAX_LIFE) * proportion
    )
end
function UnitStateUtil.getUnitManaP(self, unitHandle)
    return GetUnitState(unitHandle, UNIT_STATE_MANA) / GetUnitState(unitHandle, UNIT_STATE_MAX_MANA)
end
function UnitStateUtil.setUnitManaP(self, unitHandle, proportion)
    return SetUnitState(
        unitHandle,
        UNIT_STATE_MANA,
        GetUnitState(unitHandle, UNIT_STATE_MAX_MANA) * proportion
    )
end
function UnitStateUtil.isInvulnerable(self, unitHandle)
    if GetUnitAbilityLevel(unitHandle, "Avul") > 0 then
        return true
    end
    return false
end
function UnitStateUtil.setInvulnerable(self, unitHandle, isInvulnerable)
    SetUnitInvulnerable(unitHandle, isInvulnerable)
end
function UnitStateUtil.addInvulnerableIfNot(self, unitHandle, dur)
    if GetUnitAbilityLevel(unitHandle, "Avul") > 0 then
        return false
    end
    SetUnitInvulnerable(unitHandle, true)
    BaseUtil.runLater(
        dur,
        function()
            SetUnitInvulnerable(unitHandle, false)
        end
    )
end
function UnitStateUtil.applyTimedLife(self, unitHandle, duration, buffid)
    if buffid == nil then
        buffid = "BHwe"
    end
    UnitApplyTimedLife(unitHandle, buffid, duration)
end
function UnitStateUtil.orderPatrol(self, unitHandle, x, y)
    IssuePointOrder(unitHandle, "patrol", x, y)
end
function UnitStateUtil.orderAttack(self, unitHandle, x, y)
    IssuePointOrder(unitHandle, "attack", x, y)
end
function UnitStateUtil.orderAttackTarget(self, unitHandle, target)
    IssueTargetOrder(unitHandle, "attack", target)
end
function UnitStateUtil.orderMove(self, unitHandle, x, y)
    IssuePointOrder(unitHandle, "move", x, y)
end
function UnitStateUtil.stunUnit(self, unitHandle, dur, effectPath)
    if effectPath == nil then
        effectPath = "Abilities\\Spells\\Human\\Thunderclap\\ThunderclapTarget.mdx"
    end
    EXPauseUnit(unitHandle, true)
    local effect = AddSpecialEffectTarget(effectPath, unitHandle, "head")
    BaseUtil.runLater(
        dur,
        function()
            EXPauseUnit(unitHandle, false)
            DestroyEffect(effect)
        end
    )
end
function UnitStateUtil.enableFlyHeight(self, unitHandle)
    UnitAddAbility(
        unitHandle,
        FourCC("Amrf")
    )
    UnitRemoveAbility(
        unitHandle,
        FourCC("Amrf")
    )
end
function UnitStateUtil.calculateStateFormula(self, formula, srcUnit, targetUnit)
    if formula == nil then
        return 0
    end
    if formula.chance ~= nil and GetRandomReal(0, 1) > formula.chance then
        return 0
    end
    local value = formula.base or 0
    if srcUnit ~= nil then
        if formula.attack then
            value = value + GetUnitState(srcUnit, UnitStateDamageMax) * formula.attack
        end
        if formula.def then
            value = value + GetUnitState(srcUnit, UnitStateArmor) * formula.def
        end
        if formula.fullPros then
            value = value + (GetHeroStr(srcUnit, true) + GetHeroAgi(srcUnit, true) + GetHeroInt(srcUnit, true)) * formula.fullPros
        end
        if formula.str then
            value = value + GetHeroStr(srcUnit, true) * formula.str
        end
        if formula.agi then
            value = value + GetHeroAgi(srcUnit, true) * formula.agi
        end
        if formula.int then
            value = value + GetHeroInt(srcUnit, true) * formula.int
        end
        if formula.hp then
            value = value + GetUnitState(srcUnit, UNIT_STATE_LIFE) * formula.hp
        end
        if formula.mana then
            value = value + GetUnitState(srcUnit, UNIT_STATE_MANA) * formula.mana
        end
        if formula.maxHp then
            value = value + GetUnitState(srcUnit, UNIT_STATE_MAX_LIFE) * formula.maxHp
        end
        if formula.maxMana then
            value = value + GetUnitState(srcUnit, UNIT_STATE_MAX_MANA) * formula.maxMana
        end
        if formula.loseHp then
            value = value + (GetUnitState(srcUnit, UNIT_STATE_MAX_LIFE) - GetUnitState(srcUnit, UNIT_STATE_LIFE)) * formula.loseHp
        end
        if formula.loseMana then
            value = value + (GetUnitState(srcUnit, UNIT_STATE_MAX_MANA) - GetUnitState(srcUnit, UNIT_STATE_MANA)) * formula.loseHp
        end
    end
    if targetUnit ~= nil then
        if formula.target_attack then
            value = value + GetUnitState(targetUnit, UnitStateDamageMax) * formula.target_attack
        end
        if formula.target_def then
            value = value + GetUnitState(targetUnit, UnitStateArmor) * formula.target_def
        end
        if formula.target_fullPros then
            value = value + (GetHeroStr(targetUnit, true) + GetHeroAgi(targetUnit, true) + GetHeroInt(targetUnit, true)) * formula.target_fullPros
        end
        if formula.target_str then
            value = value + GetHeroStr(targetUnit, true) * formula.target_str
        end
        if formula.target_agi then
            value = value + GetHeroAgi(targetUnit, true) * formula.target_agi
        end
        if formula.target_int then
            value = value + GetHeroInt(targetUnit, true) * formula.target_int
        end
        if formula.target_hp then
            value = value + GetUnitState(targetUnit, UNIT_STATE_LIFE) * formula.target_hp
        end
        if formula.target_mana then
            value = value + GetUnitState(targetUnit, UNIT_STATE_MANA) * formula.target_mana
        end
        if formula.target_maxHp then
            value = value + GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE) * formula.target_maxHp
        end
        if formula.target_maxMana then
            value = value + GetUnitState(targetUnit, UNIT_STATE_MAX_MANA) * formula.target_maxMana
        end
        if formula.target_loseHp then
            value = value + (GetUnitState(targetUnit, UNIT_STATE_MAX_LIFE) - GetUnitState(targetUnit, UNIT_STATE_LIFE)) * formula.target_loseHp
        end
        if formula.target_loseMana then
            value = value + (GetUnitState(targetUnit, UNIT_STATE_MAX_MANA) - GetUnitState(targetUnit, UNIT_STATE_MANA)) * formula.target_loseHp
        end
    end
    local player = GetOwningPlayer(srcUnit)
    if IsHandle(player) then
        if formula.gold then
            value = value + GetPlayerState(player, PLAYER_STATE_RESOURCE_GOLD) * formula.gold
        end
        if formula.lumber then
            value = value + GetPlayerState(player, PLAYER_STATE_RESOURCE_LUMBER) * formula.lumber
        end
        if formula.food then
            value = value + GetPlayerState(player, PLAYER_STATE_RESOURCE_FOOD_USED) * formula.food
        end
        if formula.kills then
            local ____opt_0 = DataBase:getPlayerSolarData(player, false)
            value = value + (____opt_0 and ____opt_0.killCount or 0) * formula.kills
        end
    end
    if formula.increased then
        value = value * (1 + formula.increased)
    end
    return value
end
return ____exports
