local ____lualib = require("lualib_bundle")
local __TS__Class = ____lualib.__TS__Class
local __TS__StringSplit = ____lualib.__TS__StringSplit
local __TS__SourceMapTraceBack = ____lualib.__TS__SourceMapTraceBack
__TS__SourceMapTraceBack(debug.getinfo(1).short_src, {["7"] = 1,["8"] = 1,["9"] = 1,["10"] = 1,["11"] = 9,["12"] = 9,["13"] = 9,["15"] = 9,["16"] = 25,["17"] = 26,["19"] = 27,["20"] = 27,["22"] = 28,["23"] = 35,["26"] = 38,["27"] = 39,["28"] = 40,["29"] = 41,["31"] = 43,["34"] = 27,["37"] = 45,["38"] = 25,["39"] = 51,["40"] = 52,["43"] = 55,["44"] = 56,["45"] = 57,["46"] = 58,["47"] = 59,["48"] = 60,["50"] = 62,["52"] = 64,["53"] = 51,["54"] = 72,["55"] = 73,["58"] = 76,["59"] = 77,["60"] = 78,["62"] = 79,["63"] = 80,["64"] = 81,["66"] = 83,["67"] = 84,["68"] = 85,["70"] = 87,["74"] = 89,["75"] = 72,["76"] = 95,["77"] = 96,["80"] = 99,["81"] = 100,["82"] = 101,["83"] = 102,["84"] = 103,["85"] = 104,["87"] = 106,["89"] = 108,["90"] = 95,["91"] = 119,["92"] = 119,["93"] = 119,["95"] = 120,["96"] = 121,["98"] = 123,["99"] = 123,["100"] = 123,["101"] = 123,["102"] = 123,["103"] = 123,["104"] = 124,["105"] = 124,["106"] = 124,["107"] = 124,["108"] = 124,["109"] = 124,["110"] = 125,["111"] = 126,["112"] = 127,["114"] = 119,["115"] = 139,["116"] = 139,["117"] = 139,["119"] = 140,["120"] = 141,["122"] = 143,["123"] = 143,["124"] = 143,["125"] = 143,["126"] = 143,["127"] = 143,["128"] = 144,["129"] = 145,["130"] = 146,["132"] = 139,["133"] = 156,["134"] = 157,["135"] = 157,["136"] = 157,["137"] = 157,["138"] = 157,["139"] = 156,["140"] = 168,["141"] = 168,["142"] = 168,["144"] = 169,["145"] = 170,["147"] = 172,["148"] = 172,["149"] = 172,["150"] = 172,["151"] = 172,["152"] = 172,["153"] = 173,["154"] = 174,["155"] = 175,["157"] = 168,["158"] = 187,["159"] = 187,["160"] = 187,["162"] = 188,["163"] = 189,["165"] = 191,["166"] = 191,["167"] = 191,["168"] = 191,["169"] = 191,["170"] = 191,["171"] = 192,["172"] = 193,["173"] = 194,["175"] = 187,["176"] = 205,["177"] = 205,["178"] = 205,["180"] = 206,["181"] = 206,["182"] = 206,["183"] = 206,["184"] = 206,["185"] = 206,["186"] = 207,["187"] = 208,["188"] = 209,["190"] = 205,["191"] = 225,["192"] = 225,["193"] = 225,["195"] = 226,["196"] = 225,["197"] = 236,["198"] = 236,["199"] = 236,["201"] = 237,["202"] = 238,["204"] = 240,["205"] = 240,["206"] = 240,["207"] = 240,["208"] = 240,["209"] = 240,["210"] = 241,["211"] = 242,["212"] = 243,["214"] = 236,["215"] = 261,["216"] = 261,["217"] = 261,["219"] = 262,["220"] = 263,["222"] = 265,["223"] = 266,["224"] = 261,["225"] = 276,["226"] = 276,["227"] = 276,["229"] = 277,["230"] = 277,["231"] = 277,["232"] = 277,["233"] = 277,["234"] = 277,["235"] = 278,["236"] = 279,["237"] = 280,["239"] = 276,["240"] = 291,["241"] = 291,["242"] = 291,["244"] = 292,["245"] = 293,["247"] = 295,["248"] = 295,["249"] = 295,["250"] = 295,["251"] = 295,["252"] = 295,["253"] = 296,["254"] = 297,["255"] = 298,["257"] = 291,["258"] = 309,["259"] = 309,["260"] = 309,["262"] = 310,["263"] = 311,["265"] = 313,["266"] = 313,["267"] = 313,["268"] = 313,["269"] = 313,["270"] = 313,["271"] = 314,["272"] = 315,["273"] = 316,["275"] = 309,["276"] = 328,["277"] = 328,["278"] = 328,["280"] = 329,["281"] = 330,["283"] = 332,["284"] = 333,["285"] = 333,["286"] = 333,["287"] = 333,["288"] = 333,["289"] = 333,["290"] = 334,["291"] = 335,["292"] = 336,["294"] = 328,["295"] = 345,["296"] = 346,["297"] = 347,["298"] = 345,["299"] = 358,["300"] = 359,["301"] = 360,["303"] = 362,["304"] = 363,["306"] = 365,["307"] = 365,["308"] = 365,["309"] = 365,["310"] = 365,["311"] = 365,["312"] = 358,["313"] = 372,["314"] = 373,["315"] = 374,["317"] = 376,["318"] = 377,["320"] = 379,["321"] = 379,["322"] = 379,["323"] = 379,["324"] = 379,["325"] = 372,["326"] = 389,["327"] = 390,["328"] = 391,["330"] = 393,["331"] = 394,["333"] = 396,["334"] = 396,["335"] = 396,["336"] = 396,["337"] = 396,["338"] = 396,["339"] = 397,["340"] = 397,["341"] = 397,["342"] = 397,["343"] = 397,["344"] = 398,["345"] = 398,["346"] = 398,["347"] = 398,["348"] = 398,["349"] = 398,["350"] = 389,["351"] = 409,["352"] = 409,["353"] = 409,["355"] = 410,["356"] = 411,["358"] = 413,["359"] = 413,["360"] = 413,["361"] = 413,["362"] = 413,["363"] = 413,["364"] = 414,["365"] = 415,["366"] = 416,["368"] = 409,["369"] = 428,["370"] = 428,["371"] = 428,["373"] = 429,["374"] = 430,["376"] = 432,["377"] = 432,["378"] = 432,["379"] = 432,["380"] = 432,["381"] = 432,["382"] = 433,["383"] = 434,["384"] = 435,["386"] = 428,["387"] = 447,["388"] = 447,["389"] = 447,["391"] = 448,["392"] = 449,["394"] = 451,["395"] = 451,["396"] = 451,["397"] = 451,["398"] = 451,["399"] = 451,["400"] = 452,["401"] = 453,["402"] = 454,["404"] = 447,["405"] = 463,["406"] = 464,["407"] = 465,["408"] = 466,["409"] = 467,["410"] = 468,["411"] = 470,["412"] = 471,["414"] = 473,["416"] = 475,["417"] = 477,["418"] = 479,["419"] = 480,["421"] = 482,["423"] = 484,["424"] = 485,["425"] = 486,["426"] = 487,["427"] = 488,["428"] = 489,["429"] = 490,["430"] = 491,["431"] = 492,["433"] = 494,["434"] = 495,["436"] = 463,["437"] = 504,["438"] = 505,["439"] = 506,["440"] = 504,["441"] = 518,["442"] = 519,["443"] = 520,["445"] = 523,["446"] = 524,["447"] = 525,["449"] = 528,["450"] = 529,["451"] = 530,["453"] = 533,["454"] = 534,["455"] = 535,["457"] = 538,["458"] = 540,["459"] = 541,["460"] = 542,["462"] = 545,["463"] = 546,["464"] = 547,["467"] = 550,["468"] = 518,["469"] = 558,["470"] = 559,["471"] = 559,["472"] = 559,["473"] = 559,["474"] = 559,["475"] = 558,["476"] = 567,["477"] = 568,["478"] = 568,["479"] = 568,["480"] = 568,["481"] = 567,["482"] = 577,["483"] = 577,["484"] = 577,["486"] = 578,["487"] = 579,["488"] = 580,["489"] = 581,["490"] = 582,["492"] = 583,["493"] = 583,["494"] = 584,["495"] = 584,["496"] = 584,["497"] = 584,["498"] = 583,["503"] = 588,["504"] = 577,["505"] = 595,["506"] = 596,["507"] = 597,["508"] = 595,["509"] = 603,["510"] = 604,["511"] = 605,["512"] = 603,["513"] = 11,["514"] = 12,["515"] = 12,["516"] = 12,["517"] = 12,["518"] = 12,["519"] = 11});
local ____exports = {}
local ____TargetType = require("solar.solar-common.constant.TargetType")
local TargetType = ____TargetType.default
local OptionType = ____TargetType.OptionType
local TargetCnType = ____TargetType.TargetCnType
____exports.default = __TS__Class()
local AbilityUtil = ____exports.default
AbilityUtil.name = "AbilityUtil"
function AbilityUtil.prototype.____constructor(self)
end
function AbilityUtil.getUnitAbilityIds(self, unit)
    local abilityIdStrs = {}
    do
        local i = 0
        while i < 100 do
            do
                local ar = EXGetUnitAbilityByIndex(unit, i)
                if not IsHandle(ar) then
                    break
                end
                local aId = EXGetAbilityId(ar)
                local aIdStr = id2string(aId)
                if ____exports.default.config.ignoreAbilityIds[aIdStr] then
                    goto __continue4
                end
                abilityIdStrs[#abilityIdStrs + 1] = aIdStr
            end
            ::__continue4::
            i = i + 1
        end
    end
    return abilityIdStrs
end
function AbilityUtil.targets2Num(self, str)
    if not str then
        return
    end
    local result = 0
    local data = __TS__StringSplit(str, ",")
    for ____, name in ipairs(data) do
        local flag = TargetType[name]
        if not flag then
            print("错误的目标允许类型: " .. name)
        end
        result = result + flag
    end
    return result
end
function AbilityUtil.targetAllow2Num(self, str)
    if not str then
        return
    end
    local result = 0
    local data = __TS__StringSplit(str, ",")
    for ____, name in ipairs(data) do
        do
            local flag = TargetCnType[name]
            if flag == nil then
                flag = TargetType[name]
            end
            if flag == nil then
                print("错误的目标允许类型: " .. name)
                goto __continue14
            end
            result = result + flag
        end
        ::__continue14::
    end
    return result
end
function AbilityUtil.option2Num(self, str)
    if not str then
        return
    end
    local result = 0
    local data = __TS__StringSplit(str, ",")
    for ____, name in ipairs(data) do
        local flag = OptionType[name]
        if not flag then
            print("错误的图标选项类型: " .. name)
        end
        result = result + flag
    end
    return result
end
function AbilityUtil.setUnitAbilityName(self, udw, abilityId, name, isref)
    if isref == nil then
        isref = false
    end
    if not name then
        print("不存在技能名字")
    end
    EXSetAbilityDataString(
        EXGetUnitAbility(udw, abilityId),
        1,
        ABILITY_DATA_NAME,
        name
    )
    EXSetAbilityDataString(
        EXGetUnitAbility(udw, abilityId),
        1,
        ABILITY_DATA_TIP,
        name
    )
    if isref then
        IncUnitAbilityLevel(udw, abilityId)
        DecUnitAbilityLevel(udw, abilityId)
    end
end
function AbilityUtil.setUnitAbilityHotkey(self, udw, abilityId, hotKey, isref)
    if isref == nil then
        isref = false
    end
    if not hotKey then
        print("不存在hotKey")
    end
    EXSetAbilityDataInteger(
        EXGetUnitAbility(udw, abilityId),
        1,
        ABILITY_DATA_HOTKET,
        hotKey
    )
    if isref then
        IncUnitAbilityLevel(udw, abilityId)
        DecUnitAbilityLevel(udw, abilityId)
    end
end
function AbilityUtil.getUnitAbilityArt(self, udw, abilityId)
    return EXGetAbilityDataString(
        EXGetUnitAbility(udw, abilityId),
        1,
        ABILITY_DATA_ART
    )
end
function AbilityUtil.setUnitAbilityArt(self, udw, abilityId, art, isref)
    if isref == nil then
        isref = false
    end
    if not art then
        print("不存在技能图标路径")
    end
    EXSetAbilityDataString(
        EXGetUnitAbility(udw, abilityId),
        1,
        ABILITY_DATA_ART,
        art
    )
    if isref then
        IncUnitAbilityLevel(udw, abilityId)
        DecUnitAbilityLevel(udw, abilityId)
    end
end
function AbilityUtil.setUnitAbilityUbertip(self, udw, skid, Ubertip, isref)
    if isref == nil then
        isref = false
    end
    if not Ubertip then
        print("不存在技能提示拓展")
    end
    EXSetAbilityDataString(
        EXGetUnitAbility(udw, skid),
        1,
        ABILITY_DATA_UBERTIP,
        Ubertip
    )
    if isref then
        IncUnitAbilityLevel(udw, skid)
        DecUnitAbilityLevel(udw, skid)
    end
end
function AbilityUtil.setUnitAbilityDataA(self, udw, skid, data, isref)
    if isref == nil then
        isref = false
    end
    EXSetAbilityDataReal(
        EXGetUnitAbility(udw, skid),
        1,
        ABILITY_DATA_DATA_A,
        data
    )
    if isref then
        IncUnitAbilityLevel(udw, skid)
        DecUnitAbilityLevel(udw, skid)
    end
end
function AbilityUtil.setUnitANclAbilityTarget(self, udw, skid, target_type, isref)
    if isref == nil then
        isref = false
    end
    ____exports.default:setUnitAbilityDataB(udw, skid, target_type, isref)
end
function AbilityUtil.setUnitAbilityDataB(self, udw, skid, DataB, isref)
    if isref == nil then
        isref = false
    end
    if not DataB then
        print("不存在技能图标路径")
    end
    EXSetAbilityDataReal(
        EXGetUnitAbility(udw, skid),
        1,
        ABILITY_DATA_DATA_B,
        DataB
    )
    if isref then
        IncUnitAbilityLevel(udw, skid)
        DecUnitAbilityLevel(udw, skid)
    end
end
function AbilityUtil.setUnitANclAbilityOption(self, udw, skid, options, isref)
    if isref == nil then
        isref = false
    end
    if not options then
        print("不存在技能选项")
    end
    local data = ____exports.default:option2Num(options)
    ____exports.default:setUnitAbilityDataC(udw, skid, data, isref)
end
function AbilityUtil.setUnitAbilityDataC(self, udw, skid, data, isref)
    if isref == nil then
        isref = false
    end
    EXSetAbilityDataReal(
        EXGetUnitAbility(udw, skid),
        1,
        ABILITY_DATA_DATA_C,
        data
    )
    if isref then
        IncUnitAbilityLevel(udw, skid)
        DecUnitAbilityLevel(udw, skid)
    end
end
function AbilityUtil.setUnitAbilityDataD(self, udw, skid, data, isref)
    if isref == nil then
        isref = false
    end
    if not data then
        print("不存在技能选项")
    end
    EXSetAbilityDataReal(
        EXGetUnitAbility(udw, skid),
        1,
        ABILITY_DATA_DATA_D,
        data
    )
    if isref then
        IncUnitAbilityLevel(udw, skid)
        DecUnitAbilityLevel(udw, skid)
    end
end
function AbilityUtil.setUnitAbilityUnitId(self, udw, skid, data, isref)
    if isref == nil then
        isref = false
    end
    if not data then
        print("不存在技能选项")
    end
    EXSetAbilityDataReal(
        EXGetUnitAbility(udw, skid),
        1,
        ABILITY_DATA_UNITID,
        data
    )
    if isref then
        IncUnitAbilityLevel(udw, skid)
        DecUnitAbilityLevel(udw, skid)
    end
end
function AbilityUtil.setUnitAbilityTargs(self, udw, skid, Targs, isref)
    if isref == nil then
        isref = false
    end
    if not Targs then
        print("不存在技能目标允许")
    end
    local data = ____exports.default:targets2Num(Targs)
    EXSetAbilityDataInteger(
        EXGetUnitAbility(udw, skid),
        1,
        ABILITY_DATA_TARGS,
        R2I(data)
    )
    if isref then
        IncUnitAbilityLevel(udw, skid)
        DecUnitAbilityLevel(udw, skid)
    end
end
function AbilityUtil.refreshAbility(self, udw, skid)
    IncUnitAbilityLevel(udw, skid)
    DecUnitAbilityLevel(udw, skid)
end
function AbilityUtil.setUnitAbilityCool(self, udw, skid, cool)
    if type(skid) == "string" then
        skid = FourCC(skid)
    end
    if not cool then
        print("不存在技能释放间隔")
    end
    EXSetAbilityDataReal(
        EXGetUnitAbility(udw, skid),
        1,
        ABILITY_DATA_COOL,
        cool
    )
end
function AbilityUtil.setUnitAbilityStateCooldown(self, udw, skid, state_cooldown)
    if type(skid) == "string" then
        skid = FourCC(skid)
    end
    if not state_cooldown then
        print("不存在技能释放间隔")
    end
    EXSetAbilityState(
        EXGetUnitAbility(udw, skid),
        ABILITY_STATE_COOLDOWN,
        state_cooldown
    )
end
function AbilityUtil.refreshUnitAbilityStateCooldown(self, udw, skid, state_cooldown)
    if type(skid) == "string" then
        skid = FourCC(skid)
    end
    if not state_cooldown then
        print("不存在技能释放间隔")
    end
    EXSetAbilityDataReal(
        EXGetUnitAbility(udw, skid),
        1,
        ABILITY_DATA_COOL,
        state_cooldown
    )
    EXSetAbilityState(
        EXGetUnitAbility(udw, skid),
        ABILITY_STATE_COOLDOWN,
        state_cooldown
    )
    EXSetAbilityDataReal(
        EXGetUnitAbility(udw, skid),
        1,
        ABILITY_DATA_COOL,
        0
    )
end
function AbilityUtil.setUnitAbilityCost(self, udw, skid, Cost, isref)
    if isref == nil then
        isref = false
    end
    if not Cost then
        print("不存在技能魔法消耗")
    end
    EXSetAbilityDataInteger(
        EXGetUnitAbility(udw, skid),
        1,
        ABILITY_DATA_COST,
        Cost
    )
    if isref then
        IncUnitAbilityLevel(udw, skid)
        DecUnitAbilityLevel(udw, skid)
    end
end
function AbilityUtil.setUnitAbilityRng(self, udw, skid, Rng, isref)
    if isref == nil then
        isref = false
    end
    if not Rng then
        print("不存在技能施法距离")
    end
    EXSetAbilityDataReal(
        EXGetUnitAbility(udw, skid),
        1,
        ABILITY_DATA_RNG,
        Rng
    )
    if isref then
        IncUnitAbilityLevel(udw, skid)
        DecUnitAbilityLevel(udw, skid)
    end
end
function AbilityUtil.setUnitAbilityArea(self, udw, skid, Area, isref)
    if isref == nil then
        isref = false
    end
    if not Area then
        print("不存在技能影响区域")
    end
    EXSetAbilityDataReal(
        EXGetUnitAbility(udw, skid),
        1,
        ABILITY_DATA_AREA,
        Area
    )
    if isref then
        IncUnitAbilityLevel(udw, skid)
        DecUnitAbilityLevel(udw, skid)
    end
end
function AbilityUtil.setTargetType(self, ability, targetType)
    if targetType == "单位" then
        EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_C, 1)
        EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_B, 1)
        EXSetAbilityDataInteger(ability, 1, ABILITY_DATA_TARGS, 0)
    elseif targetType == "点" then
        if EXGetAbilityDataReal(ability, 1, ABILITY_DATA_AREA) < 100 then
            EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_C, 1)
        else
            EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_C, 3)
        end
        EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_B, 2)
    elseif targetType == "单位或点" then
        if EXGetAbilityDataReal(ability, 1, ABILITY_DATA_AREA) < 100 then
            EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_C, 1)
        else
            EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_C, 3)
        end
        EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_B, 3)
        EXSetAbilityDataInteger(ability, 1, ABILITY_DATA_TARGS, 0)
    elseif targetType == "物品" then
        EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_C, 1)
        EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_B, 1)
        EXSetAbilityDataInteger(ability, 1, ABILITY_DATA_TARGS, 32)
    elseif targetType == "无目标" then
        EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_C, 1)
        EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_B, 0)
    else
        EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_C, 1)
        EXSetAbilityDataReal(ability, 1, ABILITY_DATA_DATA_B, 0)
    end
end
function AbilityUtil.setTargetAllow(self, ability, targetAllow)
    local allow2Num = ____exports.default:targetAllow2Num(targetAllow)
    EXSetAbilityDataInteger(ability, 1, ABILITY_DATA_TARGS, allow2Num)
end
function AbilityUtil.getSpellXY(self, attype, store)
    if not store then
        store = {}
    end
    if attype == 0 then
        store.x = GetUnitX(GetTriggerUnit())
        store.y = GetUnitY(GetTriggerUnit())
    end
    if attype == 1 then
        store.x = GetUnitX(GetSpellTargetUnit())
        store.y = GetUnitY(GetSpellTargetUnit())
    end
    if attype == 2 then
        store.x = GetSpellTargetX()
        store.y = GetSpellTargetY()
    end
    if attype == 2 then
        if GetSpellTargetX() ~= 0 and GetSpellTargetY() ~= 0 then
            store.x = GetSpellTargetX()
            store.y = GetSpellTargetY()
        end
        if GetUnitX(GetSpellTargetUnit()) ~= 0 and GetUnitY(GetSpellTargetUnit()) ~= 0 then
            store.x = GetUnitX(GetSpellTargetUnit())
            store.y = GetUnitY(GetSpellTargetUnit())
        end
    end
    return store
end
function AbilityUtil.getUnitAbilityCool(self, udw, skid)
    return EXGetAbilityDataReal(
        EXGetUnitAbility(udw, skid),
        GetUnitAbilityLevel(udw, skid),
        ABILITY_DATA_COOL
    )
end
function AbilityUtil.getUnitAbilityStateCooldown(self, udw, skid)
    return EXGetAbilityState(
        EXGetUnitAbility(udw, skid),
        ABILITY_STATE_COOLDOWN
    )
end
function AbilityUtil.studyHeroAbilLists(self, hero, maxLevel)
    if maxLevel == nil then
        maxLevel = 50
    end
    local uobj = _g_objs.unit[id2string(GetUnitTypeId(hero))]
    local heroAbilList = uobj.heroAbilList or ""
    local heroAbilLists = __TS__StringSplit(heroAbilList, ",")
    for ____, abilityId in ipairs(heroAbilLists) do
        if abilityId and #abilityId == 4 then
            do
                local i = 0
                while i < maxLevel do
                    SelectHeroSkill(
                        hero,
                        FourCC(abilityId)
                    )
                    i = i + 1
                end
            end
        end
    end
    return heroAbilLists
end
function AbilityUtil.isSelectUi(self)
    local ability, order = button(3, 2)
    return order == 851979
end
function AbilityUtil.isBookUi(self)
    local ability, order = button(3, 2)
    return order == 851975
end
AbilityUtil.config = {ignoreAbilityIds = {
    Ahrp = true,
    Amil = true,
    Ahar = true,
    Aatk = true,
    Amov = true
}}
return ____exports
