local ____lualib = require("lualib_bundle")
local __TS__Class = ____lualib.__TS__Class
local __TS__SourceMapTraceBack = ____lualib.__TS__SourceMapTraceBack
__TS__SourceMapTraceBack(debug.getinfo(1).short_src, {["6"] = 1,["7"] = 1,["8"] = 2,["9"] = 2,["10"] = 3,["11"] = 3,["12"] = 4,["13"] = 4,["14"] = 5,["15"] = 5,["16"] = 6,["17"] = 6,["18"] = 8,["19"] = 8,["20"] = 8,["22"] = 8,["23"] = 22,["24"] = 22,["25"] = 22,["27"] = 23,["28"] = 23,["30"] = 23,["31"] = 23,["33"] = 24,["34"] = 24,["36"] = 24,["37"] = 24,["39"] = 25,["40"] = 26,["41"] = 27,["42"] = 28,["43"] = 29,["45"] = 31,["47"] = 33,["48"] = 33,["49"] = 33,["50"] = 33,["51"] = 33,["52"] = 33,["53"] = 33,["54"] = 33,["55"] = 33,["56"] = 33,["57"] = 34,["58"] = 22,["59"] = 48,["60"] = 48,["61"] = 48,["63"] = 49,["64"] = 49,["66"] = 49,["67"] = 49,["69"] = 50,["70"] = 50,["72"] = 50,["73"] = 50,["75"] = 51,["76"] = 52,["77"] = 53,["78"] = 54,["79"] = 55,["80"] = 56,["81"] = 57,["83"] = 59,["85"] = 61,["86"] = 61,["87"] = 61,["88"] = 61,["89"] = 61,["90"] = 61,["91"] = 61,["92"] = 61,["93"] = 61,["94"] = 61,["95"] = 62,["96"] = 63,["97"] = 48,["98"] = 79,["99"] = 79,["100"] = 79,["102"] = 80,["103"] = 80,["105"] = 80,["106"] = 80,["108"] = 81,["109"] = 81,["111"] = 82,["112"] = 82,["114"] = 82,["115"] = 82,["117"] = 82,["118"] = 82,["120"] = 83,["121"] = 84,["122"] = 85,["123"] = 86,["124"] = 86,["125"] = 86,["126"] = 86,["127"] = 87,["128"] = 88,["130"] = 90,["132"] = 92,["133"] = 92,["134"] = 92,["135"] = 92,["136"] = 92,["137"] = 92,["138"] = 92,["139"] = 92,["140"] = 92,["141"] = 92,["142"] = 86,["143"] = 86,["144"] = 86,["145"] = 86,["146"] = 94,["147"] = 79,["148"] = 110,["149"] = 110,["150"] = 110,["152"] = 111,["153"] = 111,["155"] = 111,["156"] = 111,["158"] = 112,["159"] = 112,["161"] = 113,["162"] = 113,["164"] = 113,["165"] = 113,["167"] = 113,["168"] = 113,["170"] = 114,["171"] = 115,["172"] = 116,["173"] = 117,["174"] = 118,["175"] = 119,["176"] = 119,["177"] = 119,["178"] = 119,["179"] = 120,["180"] = 121,["182"] = 123,["184"] = 125,["185"] = 125,["186"] = 125,["187"] = 125,["188"] = 125,["189"] = 125,["190"] = 125,["191"] = 125,["192"] = 125,["193"] = 125,["194"] = 119,["195"] = 119,["196"] = 119,["197"] = 119,["198"] = 127,["199"] = 128,["200"] = 110,["201"] = 145,["202"] = 146,["203"] = 146,["205"] = 146,["206"] = 146,["208"] = 147,["209"] = 147,["211"] = 147,["212"] = 147,["214"] = 147,["215"] = 147,["217"] = 148,["218"] = 149,["219"] = 150,["220"] = 150,["221"] = 150,["222"] = 150,["223"] = 150,["224"] = 150,["225"] = 151,["226"] = 152,["227"] = 153,["228"] = 154,["229"] = 155,["230"] = 155,["231"] = 155,["232"] = 155,["233"] = 156,["234"] = 156,["235"] = 156,["236"] = 156,["237"] = 156,["238"] = 156,["239"] = 157,["240"] = 157,["241"] = 157,["242"] = 157,["243"] = 157,["244"] = 157,["245"] = 158,["246"] = 158,["247"] = 158,["248"] = 158,["249"] = 158,["250"] = 158,["251"] = 159,["252"] = 160,["253"] = 161,["255"] = 163,["257"] = 165,["258"] = 165,["259"] = 165,["260"] = 165,["261"] = 165,["262"] = 165,["263"] = 165,["264"] = 165,["265"] = 165,["266"] = 165,["268"] = 155,["269"] = 155,["270"] = 155,["271"] = 155,["272"] = 168,["273"] = 145,["274"] = 185,["275"] = 186,["276"] = 186,["278"] = 186,["279"] = 186,["281"] = 187,["282"] = 187,["284"] = 187,["285"] = 187,["287"] = 187,["288"] = 187,["290"] = 188,["291"] = 189,["292"] = 190,["293"] = 190,["294"] = 190,["295"] = 190,["296"] = 190,["297"] = 190,["298"] = 190,["299"] = 190,["300"] = 190,["301"] = 190,["302"] = 190,["303"] = 190,["304"] = 190,["305"] = 192,["306"] = 193,["307"] = 185,["308"] = 200,["309"] = 201,["310"] = 200,["311"] = 214,["312"] = 215,["314"] = 216,["315"] = 216,["316"] = 217,["317"] = 218,["319"] = 216,["322"] = 221,["323"] = 214,["324"] = 227,["325"] = 228,["326"] = 227,["327"] = 234,["328"] = 235,["329"] = 234,["330"] = 242,["331"] = 243,["332"] = 242,["333"] = 250,["334"] = 251,["335"] = 250,["336"] = 258,["337"] = 259,["338"] = 258,["339"] = 266,["340"] = 267,["342"] = 268,["343"] = 268,["344"] = 269,["345"] = 268,["348"] = 271,["349"] = 266,["350"] = 277,["351"] = 278,["353"] = 279,["354"] = 279,["355"] = 280,["356"] = 279,["359"] = 282,["360"] = 277,["361"] = 10,["362"] = 11,["363"] = 12,["364"] = 12,["365"] = 12,["366"] = 12,["367"] = 12,["368"] = 12,["369"] = 12});
local ____exports = {}
local ____DamageType = require("solar.solar-common.constant.DamageType")
local DamageType = ____DamageType.default
local ____MathUtil = require("solar.solar-common.util.math.MathUtil")
local MathUtil = ____MathUtil.default
local ____SelectUtil = require("solar.solar-common.util.unit.SelectUtil")
local SelectUtil = ____SelectUtil.default
local ____WeaponType = require("solar.solar-common.constant.WeaponType")
local WeaponType = ____WeaponType.default
local ____LangUtil = require("solar.solar-common.util.lang.LangUtil")
local LangUtil = ____LangUtil.default
local ____UnitStateUtil = require("solar.solar-common.util.unit.UnitStateUtil")
local UnitStateUtil = ____UnitStateUtil.default
____exports.default = __TS__Class()
local DamageUtil = ____exports.default
DamageUtil.name = "DamageUtil"
function DamageUtil.prototype.____constructor(self)
end
function DamageUtil.damage(self, whichUnit, target, damageOrFormula, damageTypeId, weaponTypeID, ranged, attack, attackType)
    if damageTypeId == nil then
        damageTypeId = DamageType.T4_NORMAL
    end
    if weaponTypeID == nil then
        weaponTypeID = WeaponType.T0_WHOKNOWS
    end
    if ranged == nil then
        ranged = true
    end
    if attack == nil then
        attack = false
    end
    if attackType == nil then
        attackType = ATTACK_TYPE_CHAOS
    end
    local dt = ____exports.default.damageTypes[damageTypeId + 1]
    local wt = ____exports.default.weaponTypes[weaponTypeID + 1]
    local damage
    if LangUtil:isNumber(damageOrFormula) then
        damage = damageOrFormula
    else
        damage = UnitStateUtil:calculateStateFormula(damageOrFormula, whichUnit, target)
    end
    UnitDamageTarget(
        whichUnit,
        target,
        damage,
        attack,
        ranged,
        attackType,
        dt,
        wt
    )
    return damage
end
function DamageUtil.damageSL(self, whichUnit, target, damageOrFormula, damageTypeId, weaponTypeID, ranged, attack, attackType)
    if damageTypeId == nil then
        damageTypeId = DamageType.T4_NORMAL
    end
    if weaponTypeID == nil then
        weaponTypeID = WeaponType.T0_WHOKNOWS
    end
    if ranged == nil then
        ranged = true
    end
    if attack == nil then
        attack = false
    end
    if attackType == nil then
        attackType = ATTACK_TYPE_CHAOS
    end
    local oldFlag = isSolarDamageEnable
    isSolarDamageEnable = true
    local dt = ____exports.default.damageTypes[damageTypeId + 1]
    local wt = ____exports.default.weaponTypes[weaponTypeID + 1]
    local damage
    if LangUtil:isNumber(damageOrFormula) then
        damage = damageOrFormula
    else
        damage = UnitStateUtil:calculateStateFormula(damageOrFormula, whichUnit, target)
    end
    UnitDamageTarget(
        whichUnit,
        target,
        damage,
        attack,
        ranged,
        attackType,
        dt,
        wt
    )
    isSolarDamageEnable = oldFlag
    return damage
end
function DamageUtil.damageEnemyUnitsInRange(self, whichUnit, radius, damageOrFormula, damageTypeId, x, y, weaponTypeId, ranged, attack, attackType)
    if damageTypeId == nil then
        damageTypeId = DamageType.T4_NORMAL
    end
    if x == nil then
        x = GetUnitX(whichUnit)
    end
    if y == nil then
        y = GetUnitY(whichUnit)
    end
    if weaponTypeId == nil then
        weaponTypeId = WeaponType.T0_WHOKNOWS
    end
    if ranged == nil then
        ranged = true
    end
    if attack == nil then
        attack = false
    end
    if attackType == nil then
        attackType = ATTACK_TYPE_CHAOS
    end
    local dt = ____exports.default.damageTypes[damageTypeId + 1]
    local wt = ____exports.default.weaponTypes[weaponTypeId + 1]
    local damage
    SelectUtil.forEnemyUnitsInRange(
        whichUnit,
        radius,
        function(____, enemy)
            if LangUtil:isNumber(damageOrFormula) then
                damage = damageOrFormula
            else
                damage = UnitStateUtil:calculateStateFormula(damageOrFormula, whichUnit, enemy)
            end
            UnitDamageTarget(
                whichUnit,
                enemy,
                damage,
                attack,
                ranged,
                attackType,
                dt,
                wt
            )
        end,
        x,
        y
    )
    return damage
end
function DamageUtil.damageEnemyUnitsInRangeSL(self, whichUnit, radius, damageOrFormula, damageTypeId, x, y, weaponTypeId, ranged, attack, attackType)
    if damageTypeId == nil then
        damageTypeId = DamageType.T4_NORMAL
    end
    if x == nil then
        x = GetUnitX(whichUnit)
    end
    if y == nil then
        y = GetUnitY(whichUnit)
    end
    if weaponTypeId == nil then
        weaponTypeId = WeaponType.T0_WHOKNOWS
    end
    if ranged == nil then
        ranged = true
    end
    if attack == nil then
        attack = false
    end
    if attackType == nil then
        attackType = ATTACK_TYPE_CHAOS
    end
    local dt = ____exports.default.damageTypes[damageTypeId + 1]
    local wt = ____exports.default.weaponTypes[weaponTypeId + 1]
    local oldFlag = isSolarDamageEnable
    isSolarDamageEnable = true
    local damage
    SelectUtil.forEnemyUnitsInRange(
        whichUnit,
        radius,
        function(____, enemy)
            if LangUtil:isNumber(damageOrFormula) then
                damage = damageOrFormula
            else
                damage = UnitStateUtil:calculateStateFormula(damageOrFormula, whichUnit, enemy)
            end
            UnitDamageTarget(
                whichUnit,
                enemy,
                damage,
                attack,
                ranged,
                attackType,
                dt,
                wt
            )
        end,
        x,
        y
    )
    isSolarDamageEnable = oldFlag
    return damage
end
function DamageUtil.damageEnemyUnitsInSector(self, whichUnit, radius, damageOrFormula, angle, targetX, targetY, damageTypeId, weaponTypeId, ranged, attack, attackType)
    if damageTypeId == nil then
        damageTypeId = DamageType.T4_NORMAL
    end
    if weaponTypeId == nil then
        weaponTypeId = WeaponType.T0_WHOKNOWS
    end
    if ranged == nil then
        ranged = true
    end
    if attack == nil then
        attack = false
    end
    if attackType == nil then
        attackType = ATTACK_TYPE_CHAOS
    end
    local dt = ____exports.default.damageTypes[damageTypeId + 1]
    local wt = ____exports.default.weaponTypes[weaponTypeId + 1]
    local degree = MathUtil.angleBetweenCoords(
        GetUnitX(whichUnit),
        GetUnitY(whichUnit),
        targetX,
        targetY
    )
    SetUnitFacing(whichUnit, degree)
    local x = GetUnitX(whichUnit) + radius * CosBJ(degree)
    local y = GetUnitY(whichUnit) + radius * SinBJ(degree)
    local damage
    SelectUtil.forEnemyUnitsInRange(
        whichUnit,
        radius,
        function(____, unitHandle)
            local angle0 = MathUtil.angleBetweenCoords(
                GetUnitX(whichUnit),
                GetUnitY(whichUnit),
                GetUnitX(unitHandle),
                GetUnitY(unitHandle)
            )
            local angle1 = MathUtil.angleBetweenCoords(
                GetUnitX(whichUnit),
                GetUnitY(whichUnit),
                targetX,
                targetY
            ) - angle / 2
            local angle2 = MathUtil.angleBetweenCoords(
                GetUnitX(whichUnit),
                GetUnitY(whichUnit),
                targetX,
                targetY
            ) + angle / 2
            if angle0 >= angle1 and angle0 <= angle2 then
                if LangUtil:isNumber(damageOrFormula) then
                    damage = damageOrFormula
                else
                    damage = UnitStateUtil:calculateStateFormula(damageOrFormula, whichUnit, unitHandle)
                end
                UnitDamageTarget(
                    whichUnit,
                    unitHandle,
                    damage,
                    attack,
                    ranged,
                    attackType,
                    dt,
                    wt
                )
            end
        end,
        x,
        y
    )
    return damage
end
function DamageUtil.damageEnemyUnitsInSectorSL(self, whichUnit, radius, damageOrFormula, angle, targetX, targetY, damageTypeId, weaponTypeId, ranged, attack, attackType)
    if damageTypeId == nil then
        damageTypeId = DamageType.T4_NORMAL
    end
    if weaponTypeId == nil then
        weaponTypeId = WeaponType.T0_WHOKNOWS
    end
    if ranged == nil then
        ranged = true
    end
    if attack == nil then
        attack = false
    end
    if attackType == nil then
        attackType = ATTACK_TYPE_CHAOS
    end
    local oldFlag = isSolarDamageEnable
    isSolarDamageEnable = true
    local damage = ____exports.default:damageEnemyUnitsInSector(
        whichUnit,
        radius,
        damageOrFormula,
        angle,
        targetX,
        targetY,
        damageTypeId,
        weaponTypeId,
        ranged,
        attack,
        attackType
    )
    isSolarDamageEnable = oldFlag
    return damage
end
function DamageUtil.isEventPhysicalDamage(self)
    return 0 ~= EXGetEventDamageData(EVENT_DAMAGE_DATA_IS_PHYSICAL)
end
function DamageUtil.isEventPhysicalDamageType(self)
    local damageTypeData = EXGetEventDamageData(EVENT_DAMAGE_DATA_DAMAGE_TYPE)
    do
        local i = 0
        while i < #____exports.default.physicalDamageType do
            if damageTypeData == ____exports.default.physicalDamageType[i + 1] then
                return true
            end
            i = i + 1
        end
    end
    return false
end
function DamageUtil.isEventAttackDamage(self)
    return 0 ~= EXGetEventDamageData(EVENT_DAMAGE_DATA_IS_ATTACK)
end
function DamageUtil.isEventRangedDamage(self)
    return 0 ~= EXGetEventDamageData(EVENT_DAMAGE_DATA_IS_RANGED)
end
function DamageUtil.isEventDamageType(self, damageType)
    return damageType == ConvertDamageType(EXGetEventDamageData(EVENT_DAMAGE_DATA_DAMAGE_TYPE))
end
function DamageUtil.isEventWeaponType(self, weaponType)
    return weaponType == ConvertWeaponType(EXGetEventDamageData(EVENT_DAMAGE_DATA_WEAPON_TYPE))
end
function DamageUtil.isEventAttackType(self, attackType)
    return attackType == ConvertAttackType(EXGetEventDamageData(EVENT_DAMAGE_DATA_ATTACK_TYPE))
end
function DamageUtil._sl_createDamageTypes(self)
    local ds = {}
    do
        local i = 0
        while i < 32 do
            ds[i + 1] = ConvertDamageType(i)
            i = i + 1
        end
    end
    return ds
end
function DamageUtil._sl_createWeaponTypes(self)
    local ws = {}
    do
        local i = 0
        while i < 24 do
            ws[i + 1] = ConvertWeaponType(i)
            i = i + 1
        end
    end
    return ws
end
DamageUtil.damageTypes = ____exports.default:_sl_createDamageTypes()
DamageUtil.weaponTypes = ____exports.default:_sl_createWeaponTypes()
DamageUtil.physicalDamageType = {
    DamageType.T4_NORMAL,
    DamageType.T5_ENHANCED,
    DamageType.T17_FORCE,
    DamageType.T21_DEFENSIVE,
    DamageType.T26_UNIVERSAL
}
return ____exports
