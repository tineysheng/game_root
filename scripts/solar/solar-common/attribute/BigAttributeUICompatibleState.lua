local ____lualib = require("lualib_bundle")
local __TS__Class = ____lualib.__TS__Class
local __TS__New = ____lualib.__TS__New
local __TS__SourceMapTraceBack = ____lualib.__TS__SourceMapTraceBack
__TS__SourceMapTraceBack(debug.getinfo(1).short_src, {["7"] = 1,["8"] = 1,["9"] = 2,["10"] = 2,["11"] = 3,["12"] = 3,["13"] = 4,["14"] = 4,["15"] = 5,["16"] = 5,["17"] = 6,["18"] = 6,["19"] = 7,["20"] = 7,["21"] = 8,["22"] = 8,["23"] = 9,["24"] = 9,["25"] = 10,["26"] = 10,["27"] = 11,["28"] = 11,["29"] = 12,["30"] = 12,["31"] = 14,["32"] = 15,["33"] = 16,["34"] = 16,["35"] = 16,["37"] = 45,["38"] = 46,["41"] = 49,["42"] = 49,["43"] = 49,["44"] = 50,["45"] = 51,["46"] = 53,["47"] = 54,["48"] = 55,["49"] = 49,["50"] = 49,["51"] = 44,["52"] = 60,["53"] = 61,["54"] = 61,["55"] = 61,["56"] = 61,["57"] = 61,["58"] = 61,["59"] = 61,["60"] = 62,["61"] = 62,["62"] = 62,["63"] = 62,["64"] = 62,["65"] = 62,["66"] = 62,["67"] = 65,["68"] = 66,["69"] = 67,["72"] = 70,["73"] = 71,["75"] = 73,["77"] = 77,["78"] = 78,["79"] = 79,["80"] = 80,["81"] = 81,["82"] = 82,["83"] = 83,["84"] = 84,["86"] = 86,["88"] = 88,["89"] = 90,["90"] = 91,["91"] = 92,["92"] = 93,["93"] = 94,["94"] = 95,["96"] = 98,["97"] = 99,["98"] = 100,["99"] = 101,["100"] = 103,["101"] = 104,["102"] = 105,["103"] = 106,["104"] = 107,["106"] = 109,["108"] = 111,["109"] = 111,["110"] = 111,["111"] = 111,["113"] = 115,["114"] = 116,["115"] = 117,["116"] = 118,["117"] = 119,["118"] = 120,["119"] = 121,["120"] = 122,["121"] = 123,["122"] = 124,["125"] = 127,["127"] = 129,["128"] = 131,["129"] = 132,["130"] = 133,["131"] = 134,["132"] = 135,["134"] = 137,["135"] = 139,["136"] = 140,["137"] = 141,["138"] = 142,["139"] = 143,["141"] = 146,["142"] = 148,["143"] = 149,["144"] = 150,["145"] = 151,["146"] = 152,["148"] = 154,["149"] = 60,["150"] = 161,["151"] = 172,["152"] = 173,["153"] = 174,["154"] = 181,["155"] = 182,["156"] = 183,["157"] = 185,["158"] = 186,["159"] = 187,["160"] = 189,["161"] = 191,["162"] = 192,["163"] = 194,["164"] = 196,["165"] = 197,["166"] = 199,["167"] = 200,["168"] = 201,["169"] = 201,["170"] = 201,["171"] = 201,["172"] = 201,["173"] = 201,["174"] = 201,["175"] = 201,["176"] = 204,["177"] = 206,["178"] = 206,["179"] = 206,["180"] = 206,["181"] = 206,["182"] = 206,["183"] = 206,["184"] = 206,["185"] = 208,["186"] = 210,["187"] = 211,["188"] = 211,["189"] = 211,["190"] = 211,["191"] = 211,["192"] = 211,["193"] = 211,["194"] = 211,["195"] = 213,["196"] = 218,["197"] = 219,["198"] = 220,["199"] = 221,["200"] = 223,["201"] = 224,["202"] = 225,["203"] = 226,["204"] = 228,["205"] = 229,["206"] = 230,["207"] = 232,["208"] = 233,["209"] = 234,["210"] = 161,["211"] = 243,["212"] = 247,["213"] = 248,["214"] = 248,["215"] = 248,["216"] = 248,["217"] = 248,["218"] = 248,["219"] = 248,["220"] = 248,["221"] = 249,["222"] = 250,["223"] = 250,["224"] = 250,["225"] = 250,["226"] = 250,["227"] = 250,["228"] = 250,["229"] = 250,["230"] = 257,["231"] = 258,["232"] = 258,["233"] = 258,["234"] = 258,["235"] = 258,["236"] = 258,["237"] = 258,["238"] = 258,["239"] = 260,["240"] = 261,["241"] = 261,["242"] = 261,["243"] = 261,["244"] = 261,["245"] = 261,["246"] = 261,["247"] = 261,["248"] = 263,["249"] = 264,["250"] = 264,["251"] = 264,["252"] = 264,["253"] = 264,["254"] = 264,["255"] = 264,["256"] = 264,["257"] = 268,["258"] = 269,["259"] = 269,["260"] = 269,["261"] = 269,["262"] = 269,["263"] = 269,["264"] = 269,["265"] = 269,["266"] = 272,["267"] = 273,["268"] = 273,["269"] = 273,["270"] = 273,["271"] = 273,["272"] = 273,["273"] = 273,["274"] = 273,["275"] = 275,["276"] = 276,["277"] = 276,["278"] = 276,["279"] = 276,["280"] = 276,["281"] = 276,["282"] = 276,["283"] = 276,["284"] = 278,["285"] = 279,["286"] = 279,["287"] = 279,["288"] = 279,["289"] = 279,["290"] = 279,["291"] = 279,["292"] = 279,["293"] = 281,["294"] = 282,["295"] = 282,["296"] = 282,["297"] = 282,["298"] = 282,["299"] = 282,["300"] = 284,["301"] = 285,["302"] = 285,["303"] = 285,["304"] = 285,["305"] = 285,["306"] = 285,["307"] = 287,["308"] = 288,["309"] = 288,["310"] = 288,["311"] = 288,["312"] = 288,["313"] = 288,["314"] = 290,["315"] = 291,["316"] = 291,["317"] = 291,["318"] = 291,["319"] = 291,["320"] = 291,["321"] = 243,["322"] = 294,["323"] = 294,["324"] = 294,["326"] = 295,["327"] = 296,["328"] = 297,["329"] = 298,["330"] = 299,["331"] = 300,["332"] = 301,["333"] = 294,["334"] = 17});
local ____exports = {}
local ____UnitUtil = require("solar.solar-common.util.unit.UnitUtil")
local UnitUtil = ____UnitUtil.default
local ____NativeFrameUtil = require("solar.solar-common.util.frame.NativeFrameUtil")
local NativeFrameUtil = ____NativeFrameUtil.default
local ____TextUtil = require("solar.solar-common.util.text.TextUtil")
local TextUtil = ____TextUtil.default
local ____trigger = require("solar.solar-common.w3ts.handles.trigger")
local Trigger = ____trigger.Trigger
local ____ColorStr = require("solar.solar-common.constant.ColorStr")
local ColorStr = ____ColorStr.default
local ____frame = require("solar.solar-common.w3ts.handles.frame")
local Frame = ____frame.Frame
local ____BaseUtil = require("solar.solar-common.util.BaseUtil")
local BaseUtil = ____BaseUtil.default
local ____SelectUtil = require("solar.solar-common.util.unit.SelectUtil")
local SelectUtil = ____SelectUtil.default
local ____HeroUtil = require("solar.solar-common.util.unit.HeroUtil")
local HeroUtil = ____HeroUtil.default
local ____ExFrameApiUtil = require("solar.solar-common.util.frame.ExFrameApiUtil")
local ExFrameApiUtil = ____ExFrameApiUtil.default
local ____SingletonUtil = require("solar.solar-common.util.lang.SingletonUtil")
local SingletonUtil = ____SingletonUtil.default
local ____UnitStateUtil = require("solar.solar-common.util.unit.UnitStateUtil")
local UnitStateUtil = ____UnitStateUtil.default
local textFont = "Fonts\\dfst-m3u.ttf"
local textHeight = 0.01
____exports.default = __TS__Class()
local BigAttributeUICompatibleState = ____exports.default
BigAttributeUICompatibleState.name = "BigAttributeUICompatibleState"
function BigAttributeUICompatibleState.prototype.____constructor(self)
    if SingletonUtil:notFirstTime(____exports.default) then
        print("不能重复new BigAttributeUICompatibleState()")
        return
    end
    BaseUtil.runLater(
        0.1,
        function()
            self:moveNativeFrame()
            self:createUI()
            local trigger = __TS__New(Trigger)
            trigger:registerTimerEvent(0.1, true)
            trigger:addAction(self.refreshSolarUI)
        end
    )
end
function BigAttributeUICompatibleState.prototype.refreshSolarUI()
    DzFrameSetText(
        ____exports.default.goldFrame,
        TextUtil:toCnUnit(GetPlayerState(
            GetLocalPlayer(),
            PLAYER_STATE_RESOURCE_GOLD
        ))
    )
    DzFrameSetText(
        ____exports.default.lumberFrame,
        TextUtil:toCnUnit(GetPlayerState(
            GetLocalPlayer(),
            PLAYER_STATE_RESOURCE_LUMBER
        ))
    )
    local unit = SelectUtil.getRealSelectUnit()
    if not IsHandle(unit) then
        ____exports.default:showSolarUI(false)
        return
    end
    if HeroUtil:isHero(unit) then
        ____exports.default:showSolarUI(true, true)
    else
        ____exports.default:showSolarUI(true, false)
    end
    local life = GetUnitState(unit, UNIT_STATE_LIFE)
    local maxLife = GetUnitState(unit, UNIT_STATE_MAX_LIFE)
    local bfbLife = R2I(life * 100 / maxLife)
    local hpText = ((TextUtil:toCnUnit(life) .. "/") .. TextUtil:toCnUnit(maxLife)) .. ("(" .. tostring(bfbLife)) .. ")%"
    if bfbLife > 80 then
        hpText = ColorStr.green .. hpText
    elseif bfbLife > 40 then
        hpText = ColorStr.yellow .. hpText
    else
        hpText = ColorStr.red .. hpText
    end
    DzFrameSetText(____exports.default.hpFrame, hpText)
    local mana = GetUnitState(unit, UNIT_STATE_MANA)
    local maxMana = GetUnitState(unit, UNIT_STATE_MAX_MANA)
    if maxMana and maxMana > 0 then
        local bfbMana = tostring(R2I(mana * 100 / maxMana)) .. "%"
        local manaText = ((TextUtil:toCnUnit(mana) .. " / ") .. TextUtil:toCnUnit(maxMana)) .. ("(" .. bfbMana) .. ")"
        DzFrameSetText(____exports.default.manaFrame, manaText)
    end
    local aAttack = GetUnitState(unit, UnitStateDamageMix)
    if ____exports.default.config.isShowGreenAttack then
        local lvAttack = GetUnitState(unit, UnitStateDamageBonus)
        local bAttack = aAttack - lvAttack
        local blText = TextUtil:toCnUnit(bAttack)
        if lvAttack > 0 then
            blText = (((blText .. "  ") .. ColorStr.green) .. "+") .. TextUtil:toCnUnit(lvAttack)
        elseif lvAttack < -20 then
            blText = ((blText .. "  ") .. ColorStr.red) .. TextUtil:toCnUnit(lvAttack)
        end
        DzFrameSetText(____exports.default.attackValueFrame, blText)
    else
        DzFrameSetText(
            ____exports.default.attackValueFrame,
            TextUtil:toCnUnit(aAttack)
        )
    end
    local armorText = nil
    if UnitStateUtil:isInvulnerable(unit) then
        armorText = "|cffffffff无敌"
    elseif ____exports.default.config.isShowGreenArmor then
        local extraDef = UnitUtil.getExtraDef(unit)
        armorText = TextUtil:toCnUnit(GetUnitState(unit, UnitStateArmor) - extraDef)
        if extraDef > 0 then
            armorText = (((tostring(armorText) .. "  ") .. ColorStr.green) .. "+") .. TextUtil:toCnUnit(extraDef)
        elseif extraDef < 0 then
            armorText = ((tostring(armorText) .. "  ") .. ColorStr.red) .. TextUtil:toCnUnit(extraDef)
        end
    else
        armorText = TextUtil:toCnUnit(GetUnitState(unit, UnitStateArmor))
    end
    DzFrameSetText(____exports.default.armorValueFrame, armorText)
    local bStr = GetHeroStr(unit, false)
    local blStr = GetHeroStr(unit, true)
    local strText = TextUtil:toCnUnit(bStr)
    if bStr ~= blStr then
        strText = (((strText .. "  ") .. ColorStr.green) .. "+") .. TextUtil:toCnUnit(blStr - bStr)
    end
    DzFrameSetText(____exports.default.heroStrValueFrame, strText)
    local bAgi = GetHeroAgi(unit, false)
    local blAgi = GetHeroAgi(unit, true)
    local agiText = TextUtil:toCnUnit(bAgi)
    if bAgi ~= blAgi then
        agiText = (((agiText .. "  ") .. ColorStr.green) .. "+") .. TextUtil:toCnUnit(blAgi - bAgi)
    end
    DzFrameSetText(____exports.default.heroAgiValueFrame, agiText)
    local bInt = GetHeroInt(unit, false)
    local blInt = GetHeroInt(unit, true)
    local intText = TextUtil:toCnUnit(bInt)
    if bInt ~= blInt then
        intText = (((intText .. "  ") .. ColorStr.green) .. "+") .. TextUtil:toCnUnit(blInt - bInt)
    end
    DzFrameSetText(____exports.default.heroIntValueFrame, intText)
end
function BigAttributeUICompatibleState.prototype.createUI(self)
    ____exports.default.unitUIContainer = ExFrameApiUtil:createBaseFrameInSimpleFrame(NativeFrameUtil:getUnitStatePanel())
    ____exports.default.unitArmorContainer = ExFrameApiUtil:createBaseFrameInSimpleFrame(DzSimpleFrameFindByName("SimpleInfoPanelIconDamage", 2))
    ____exports.default.heroUIContainer = ExFrameApiUtil:createBaseFrameInSimpleFrame(NativeFrameUtil:getHeroStatePanel())
    ____exports.default.goldFrame = __TS__New(Frame, "TEXT").current
    DzFrameSetAbsolutePoint(____exports.default.goldFrame, FRAMEPOINT_TOPRIGHT, 0.533, 0.595)
    DzFrameSetFont(____exports.default.goldFrame, textFont, textHeight, 0)
    ____exports.default.lumberFrame = __TS__New(Frame, "TEXT").current
    DzFrameSetAbsolutePoint(____exports.default.lumberFrame, FRAMEPOINT_TOPRIGHT, 0.621, 0.595)
    DzFrameSetFont(____exports.default.lumberFrame, textFont, textHeight, 0)
    ____exports.default.attackValueFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.unitUIContainer).current
    DzFrameSetAbsolutePoint(____exports.default.attackValueFrame, FRAMEPOINT_TOPLEFT, 0.35, 0.07)
    DzFrameSetFont(____exports.default.attackValueFrame, textFont, textHeight, 0)
    ____exports.default.armorValueFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.unitArmorContainer).current
    DzFrameSetAbsolutePoint(____exports.default.armorValueFrame, FRAMEPOINT_TOPLEFT, 0.35, 0.036)
    DzFrameSetFont(____exports.default.armorValueFrame, textFont, textHeight, 0)
    ____exports.default.heroStrValueFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.heroUIContainer).current
    DzFrameSetFont(____exports.default.heroStrValueFrame, textFont, textHeight, 0)
    DzFrameSetPoint(
        ____exports.default.heroStrValueFrame,
        FRAMEPOINT_TOPLEFT,
        NativeFrameUtil:getHeroStrLabel(),
        FRAMEPOINT_BOTTOMLEFT,
        0.005,
        0
    )
    ____exports.default.heroAgiValueFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.heroUIContainer).current
    DzFrameSetPoint(
        ____exports.default.heroAgiValueFrame,
        FRAMEPOINT_TOPLEFT,
        NativeFrameUtil:getHeroAgiLabel(),
        FRAMEPOINT_BOTTOMLEFT,
        0.005,
        0
    )
    DzFrameSetFont(____exports.default.heroAgiValueFrame, textFont, textHeight, 0)
    ____exports.default.heroIntValueFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.heroUIContainer).current
    DzFrameSetPoint(
        ____exports.default.heroIntValueFrame,
        FRAMEPOINT_TOPLEFT,
        NativeFrameUtil:getHeroIntLabel(),
        FRAMEPOINT_BOTTOMLEFT,
        0.005,
        0
    )
    DzFrameSetFont(____exports.default.heroIntValueFrame, textFont, textHeight, 0)
    ____exports.default.hpBackdropFrame = __TS__New(Frame, "BACKDROP", nil, ____exports.default.unitArmorContainer).current
    DzFrameSetTexture(____exports.default.hpBackdropFrame, "UI\\Glues\\SinglePlayer\\HumanCampaign3D\\Black32.blp", 0)
    DzFrameSetSize(____exports.default.hpBackdropFrame, 0.076, 0.012)
    DzFrameSetAbsolutePoint(____exports.default.hpBackdropFrame, FRAMEPOINT_CENTER, 0.254, 0.023)
    ____exports.default.manaBackdropFrame = __TS__New(Frame, "BACKDROP", nil, ____exports.default.unitArmorContainer).current
    DzFrameSetSize(____exports.default.manaBackdropFrame, 0.076, 0.012)
    DzFrameSetTexture(____exports.default.manaBackdropFrame, "UI\\Glues\\SinglePlayer\\HumanCampaign3D\\Black32.blp", 0)
    DzFrameSetAbsolutePoint(____exports.default.manaBackdropFrame, FRAMEPOINT_CENTER, 0.254, 0.009)
    ____exports.default.hpFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.unitArmorContainer).current
    DzFrameSetFont(____exports.default.hpFrame, textFont, textHeight, 0)
    DzFrameSetAbsolutePoint(____exports.default.hpFrame, FRAMEPOINT_CENTER, 0.254, 0.023)
    ____exports.default.manaFrame = __TS__New(Frame, "TEXT", nil, ____exports.default.unitArmorContainer).current
    DzFrameSetAbsolutePoint(____exports.default.manaFrame, FRAMEPOINT_CENTER, 0.254, 0.009)
    DzFrameSetFont(____exports.default.manaFrame, textFont, textHeight, 0)
end
function BigAttributeUICompatibleState.prototype.moveNativeFrame(self)
    DzFrameClearAllPoints(NativeFrameUtil:getUnitAttackIcon(0))
    DzFrameSetPoint(
        NativeFrameUtil:getUnitAttackIcon(0),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getUnitArmorIcon())
    DzFrameSetPoint(
        NativeFrameUtil:getUnitArmorIcon(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getGoldText())
    DzFrameSetPoint(
        NativeFrameUtil:getGoldText(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getLumberText())
    DzFrameSetPoint(
        NativeFrameUtil:getLumberText(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getUnitAttackValue(0))
    DzFrameSetPoint(
        NativeFrameUtil:getUnitAttackValue(0),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getUnitArmorValue())
    DzFrameSetPoint(
        NativeFrameUtil:getUnitArmorValue(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getHeroStrValue())
    DzFrameSetPoint(
        NativeFrameUtil:getHeroStrValue(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getHeroAgiValue())
    DzFrameSetPoint(
        NativeFrameUtil:getHeroAgiValue(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getHeroIntValue())
    DzFrameSetPoint(
        NativeFrameUtil:getHeroIntValue(),
        4,
        DzGetGameUI(),
        4,
        0,
        -0.5
    )
    DzFrameClearAllPoints(NativeFrameUtil:getUnitAttackLabel(0))
    DzFrameSetAbsolutePoint(
        NativeFrameUtil:getUnitAttackLabel(0),
        FRAMEPOINT_TOPLEFT,
        0.34,
        0.08
    )
    DzFrameClearAllPoints(NativeFrameUtil:getUnitArmorLabel())
    DzFrameSetAbsolutePoint(
        NativeFrameUtil:getUnitArmorLabel(),
        FRAMEPOINT_TOPLEFT,
        0.34,
        0.048
    )
    DzFrameClearAllPoints(NativeFrameUtil:getHeroAgiLabel())
    DzFrameSetAbsolutePoint(
        NativeFrameUtil:getHeroAgiLabel(),
        FRAMEPOINT_TOPLEFT,
        0.44,
        0.06
    )
    DzFrameClearAllPoints(NativeFrameUtil:getHeroIntLabel())
    DzFrameSetAbsolutePoint(
        NativeFrameUtil:getHeroIntLabel(),
        FRAMEPOINT_TOPLEFT,
        0.44,
        0.04
    )
end
function BigAttributeUICompatibleState.showSolarUI(self, showAttackAndArmor, showHeroAtts)
    if showHeroAtts == nil then
        showHeroAtts = showAttackAndArmor
    end
    DzFrameShow(____exports.default.hpFrame, showAttackAndArmor)
    DzFrameShow(____exports.default.manaFrame, showAttackAndArmor)
    DzFrameShow(____exports.default.attackValueFrame, showAttackAndArmor)
    DzFrameShow(____exports.default.armorValueFrame, showAttackAndArmor)
    DzFrameShow(____exports.default.heroStrValueFrame, showHeroAtts)
    DzFrameShow(____exports.default.heroAgiValueFrame, showHeroAtts)
    DzFrameShow(____exports.default.heroIntValueFrame, showHeroAtts)
end
BigAttributeUICompatibleState.config = {isShowGreenAttack = false, isShowGreenArmor = false}
return ____exports
